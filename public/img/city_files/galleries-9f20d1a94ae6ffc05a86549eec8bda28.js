!function(e,t){e.fn.extend({scrollspy:function(o){var r={min:0,max:0,mode:"vertical",namespace:"scrollspy",buffer:0,container:t,onEnter:o.onEnter?o.onEnter:[],onLeave:o.onLeave?o.onLeave:[],onTick:o.onTick?o.onTick:[]},o=e.extend({},r,o);return this.each(function(){var t=this,r=o,i=e(r.container),n=r.mode,s=r.buffer,a=leaves=0,l=!1;i.bind("scroll."+r.namespace,function(){var o={top:e(this).scrollTop(),left:e(this).scrollLeft()},p="vertical"==n?o.top+s:o.left+s,u=r.max,h=r.min;e.isFunction(r.max)&&(u=r.max()),e.isFunction(r.min)&&(h=r.min()),0==u&&(u="vertical"==n?i.height():i.outerWidth()+e(t).outerWidth()),p>=h&&u>=p?(l||(l=!0,a++,e(t).trigger("scrollEnter",{position:o}),e.isFunction(r.onEnter)&&r.onEnter(t,o)),e(t).trigger("scrollTick",{position:o,inside:l,enters:a,leaves:leaves}),e.isFunction(r.onTick)&&r.onTick(t,o,l,a,leaves)):l&&(l=!1,leaves++,e(t).trigger("scrollLeave",{position:o,leaves:leaves}),e.isFunction(r.onLeave)&&r.onLeave(t,o))})})}})}(jQuery,window,document,void 0),function(){var e,t,o={}.hasOwnProperty,r=function(e,t){function r(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};e=App.module("Galleries"),e.Router=function(e){function o(){return t=o.__super__.constructor.apply(this,arguments)}return r(o,e),o.prototype.appRoutes={":username/galleries/:gallery_path":"showPublicGallery","g/:token":"showPrivateGallery","photo/:photo_id/:photo_slug":"showPhoto"},o.prototype.initialize=function(){return this.bind("route",this._trackPageview)},o.prototype._trackPageview=function(){var e;return e=Backbone.history.getFragment(),PxApp.GA.pageview(e)},o}(Backbone.Marionette.AppRouter)}.call(this),function(){var e={}.hasOwnProperty,t=function(t,o){function r(){this.constructor=t}for(var i in o)e.call(o,i)&&(t[i]=o[i]);return r.prototype=o.prototype,t.prototype=new r,t.__super__=o.prototype,t};PxApp.Model=function(e){function o(){o.__super__.constructor.apply(this,arguments),this.original_attributes=_.extend({},this.attributes)}return t(o,e),o.prototype.fetch=function(e){var t,r,i;return null==e&&(e={}),console.log("Fetching model..."),t=$.Deferred(),i=e.success,r=e.error,e.success=function(e,o,r){return t.resolve(e,o,r),"function"==typeof i&&i(e,o,r),console.log("Fetching success!")},e.error=function(e,o,i){return t.reject(e,o,i),"function"==typeof r&&r(e,o,i),console.log("Fetching ERROR!")},o.__super__.fetch.call(this,e),t.promise()},o.prototype.save=function(e,t){var r,i,n,s,a=this;return null==t&&(t={}),r=$.Deferred(),s=t.success,i=t.error,t.success=function(e,t,o){return a.original_attributes=_.extend({},a.attributes),r.resolve(e,t,o),"function"==typeof s?s(e,t,o):void 0},t.error=function(e,t,o){return r.reject(e,t,o),"function"==typeof i?i(e,t,o):void 0},n=o.__super__.save.call(this,e,t),!1===n&&r.reject(this.validationError),r.promise()},o.prototype.reload=function(){return this.set(this.original_attributes),this.validationError=null},o.prototype.destroy=function(e){var t,r,i,n;return null==e&&(e={}),t=$.Deferred(),n=e.success,r=e.error,e.success=function(e,o,r){return t.resolve(e,o,r),"function"==typeof n?n(e,o,r):void 0},e.error=function(e,o,i){return t.reject(e,o,i),"function"==typeof r?r(e,o,i):void 0},i=o.__super__.destroy.call(this,e),!1===i&&t.reject(),t.promise()},o.prototype.errors=function(){var e;return null!=(e=this.validationError)?e:{}},o.prototype.validate=function(e){var t,o,r,i,n,s;if(null==this.get("id")&&e.id)return!1;r={},o=0;for(t in e)n=e[t],i="function"==typeof this[s="validate_"+t]?this[s](n,e):void 0,i&&(r[t]=i,o++);return o>0?r:void 0},o}(Backbone.Model)}.call(this),function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}},o={}.hasOwnProperty,r=function(e,t){function r(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};PxApp.Models.User=function(o){function i(){return this.is_active=t(this.is_active,this),this.get_comments=t(this.get_comments,this),this.user_link=t(this.user_link,this),this.is_free=t(this.is_free,this),this.avatar_url=t(this.avatar_url,this),this.membership_name=t(this.membership_name,this),this.url=t(this.url,this),e=i.__super__.constructor.apply(this,arguments)}return r(i,o),i.MEMBER={FREE:0,PLUS:1,AWESOME:2,PARTNER:3,EDITOR:8},i.prototype.AVATAR_NUMBERS={"default":1,large:2,medium:2,small:3,tiny:4},i.prototype.AVATAR_NUMBERS_RETINA={"default":1,large:1,medium:1,small:2,tiny:3},i.prototype.AVATAR_SIZES={tiny:30,small:50,medium:64,large:100,"default":300},i.USER_AVATAR_DIRECTIVES={"class":function(){var e;return e=["user_avatar"],this.user_avatar.user&&e.push("user_"+this.user_avatar.user.membership_name()),e.push("size_"+this.user_avatar.size),this.user_avatar.user&&!this.user_avatar.user.is_active()&&e.push("deactivated"),e.join(" ")},"data-user-id":function(){return this.user_avatar.user?this.user_avatar.user.id:void 0},tooltip:{"class":function(){var e;return e=["tooltip"],this.user&&this.tooltip&&this.user.is_active()&&this.user.id&&e.push("display"),e.join(" ")},text:function(){return this.user&&this.user.id?this.user.get("fullname"):void 0}},link:{href:function(){return this.user&&this.user.id?this.user.is_active()?""+PxAppUrl+"/"+this.user.get("username"):null:null}},image:{src:function(){return this.user?this.user.avatar_url(this.size):""+PxAppUrl+"/graphics/userpic.png"}},membership_icon:{"class":function(){var e;return e=["membership_tag"],this.user?e.push(""+this.user.membership_name()):e.push("free"),e.join(" ")},href:function(){var e;return this.user&&(e=function(){switch(this.user.membership_name()){case"staff":return"/team";case"editor":return"/editors";case"plus":return"/upgrade";case"awesome":return"/upgrade"}}.call(this))?""+PxAppUrl+e:void 0},text:function(){var e;return this.user?e=function(){switch(this.user.membership_name()){case"staff":return"500px";case"editor":return"Editor";case"plus":return"Plus";case"awesome":return"Awesome";case"partner":return"Partner"}}.call(this):void 0}}},i.prototype.url=function(){return"/users/"+this.id},i.prototype.membership_name=function(){if(this.get("admin"))return"staff";if(this.get("usertype")===this.constructor.MEMBER.PARTNER)return"partner";if(this.get("usertype")===this.constructor.MEMBER.EDITOR)return"editor";switch(this.get("upgrade_status")){case 0:return"free";case 1:return"plus";case 2:return"awesome"}},i.prototype.membership_text=function(){var e;return e=function(){switch(this.membership_name()){case"staff":return"500px";case"editor":return"Editor";case"plus":return"Plus";case"awesome":return"Awesome";case"partner":return"Partner"}}.call(this)},i.prototype.avatar_url=function(e){var t,o;return o=this.get("userpic_url"),t=PxInitialData.avatar_cdn_url.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1"),o.match(new RegExp("^"+t))&&(o=window.devicePixelRatio>1?o.replace(/\d+(?=\.jpg(?:\?\d+)?$)/,this.AVATAR_NUMBERS_RETINA[e]):o.replace(/\d+(?=\.jpg(?:\?\d+)?$)/,this.AVATAR_NUMBERS[e])),o},i.prototype.is_free=function(){return this.get("upgrade_status")===this.constructor.MEMBER.FREE},i.prototype.is_plus=function(){return this.get("upgrade_status")===this.constructor.MEMBER.PLUS},i.prototype.hasGATrackingEnabled=function(){return this.get("upgrade_status")>0},i.prototype.user_link=function(){return this.is_active()?$(_.template('<a href="%{url}" class="user_profile_link">%{fullname}</a>',{url:""+PxAppUrl+"/"+this.get("username"),fullname:this.get("fullname")})):$(_.template('<a class="user_profile_link inactive">%{fullname}</a>',{fullname:this.get("fullname")}))},i.prototype.get_comments=function(e){var t,o=this;return t=PxApp.api.get("/users/"+this.id+"/comments?sort=created_at&nested=1&include_flagged=1"),t.success(function(t){return o.comments=new PxApp.Collections.User.Comments(t.comments,{target:o}),null!=e(o)})},i.prototype.parse=function(e){var t;return null!=(t=e.user)?t:e},i.prototype.is_active=function(){return!this.get("banned")&&!this.get("deactivated")&&!this.get("not_active")},i.prototype.isRolledOut=function(e){var t;return!!(null!=(t=this.get("rollout"))?t[e]:void 0)},i}(PxApp.Model)}.call(this),function(){var e,t,o={}.hasOwnProperty,r=function(e,t){function r(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};e=App.module("Models"),e.User=function(e){function o(){return t=o.__super__.constructor.apply(this,arguments)}return r(o,e),o.prototype.STATUS_ACTIVE=1,o.prototype.initialize=function(){var e=this;return App.vent.on("photo_deleted",function(t){var o,r,i;return t.get("status")===e.STATUS_ACTIVE&&null!=e.get("upload_limit")&&e.get("upload_limit")<20&&(r=new Date,r.setDate(r.getDate()+1),o=new Date,o.setDate(r.getDate()-7),i=new Date(t.get("created_at")),i>o)?e.set("upload_limit",e.get("upload_limit")+1):void 0})},o.prototype.isRegisteredAfter=function(e){if(null==e)throw new Error("must provide cutOffDate");return moment(this.get("registration_date")).isAfter(e)},o.prototype.hasLocation=function(){return""!==this.get("city")||""!==this.get("state")||""!==this.get("country")},o}(PxApp.Models.User)}.call(this),function(){App.module("Galleries",function(e){return e.addInitializer(function(){return null!=("undefined"!=typeof PxCurrentUser&&null!==PxCurrentUser?PxCurrentUser.user:void 0)&&null==App.currentUser&&(App.currentUser=new App.Models.User(JSON.parse(PxCurrentUser.user))),$(function(){return $("body").toggleClass("logged_in",null!=App.currentUser),PxApp.GA.set_member_type_and_user_id(PxCurrentUser.type,PxCurrentUser.id)}),App.controller=new e.Controller,App.router=App.controller.router=new e.Router({controller:App.controller})})})}.call(this),function(){var e,t,o={}.hasOwnProperty,r=function(e,t){function r(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};e=App.module("Photos"),e.Router=function(e){function o(){return t=o.__super__.constructor.apply(this,arguments)}return r(o,e),o.prototype.appRoutes={"photo/(:photo_id)(/:photo_slug)":"show"},o.prototype.navigate=function(e,t){var r;return null==t&&(t={}),r=App.currentPath(),e.replace(/(\?|&)page=\d+\b/,"")===r.replace(/(\?|&)page=\d+\b/,"")&&null==t.replace&&(t.replace=!0),o.__super__.navigate.call(this,e,t),this._trackPageview()},o.prototype.initialize=function(){return this.bind("route",this._trackPageview)},o.prototype._trackPageview=function(){var e;return e=Backbone.history.getFragment(),PxApp.GA.pageview(e)},o}(Backbone.Marionette.AppRouter)}.call(this),function(){App.module("Photos",function(e){return e.addInitializer(function(){return null!=window.standalonePhotoPage?(null!=("undefined"!=typeof PxCurrentUser&&null!==PxCurrentUser?PxCurrentUser.user:void 0)&&null==App.currentUser&&(App.currentUser=new App.Models.User(JSON.parse(PxCurrentUser.user))),$(function(){return $("body").toggleClass("logged_in",null!=App.currentUser),PxApp.GA.set_member_type_and_user_id(PxCurrentUser.type,PxCurrentUser.id)}),App.controller=new e.Controller,App.router=App.controller.router=new e.Router({controller:App.controller})):void 0})})}.call(this),function(){var e,t,o={}.hasOwnProperty,r=function(e,t){function r(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};e=App.module("Models"),e.Photo=function(e){function o(){return t=o.__super__.constructor.apply(this,arguments)}return r(o,e),o.prototype.initialize=function(){return o.__super__.initialize.apply(this,arguments),this.imagesDownloadPromises={},this.imagesDownloaded={}},o.prototype.url=function(){return"https://api.500px.com/v1/photos/"+this.id},o.prototype._imageDownloadKey=function(e){return"size:"+e.size+"-https:"+e.https},o.prototype.prefetchImage=function(e){var t;return _.defaults(e,{size:4,https:!0}),t=this._imageDownloadKey(e),this.imagesDownloaded[t]||null!=this.imagesDownloadPromises[t]?void 0:this.downloadImage(e)},o.prototype.isImageDownloaded=function(e){return _.defaults(e,{size:4,https:!0}),this.imagesDownloaded[this._imageDownloadKey(e)]},o.prototype.downloadImage=function(e){var t,o,r,i,n=this;return _.defaults(e,{size:4,https:!0}),r=this._imageDownloadKey(e),this.imagesDownloadPromises[r]?this.imagesDownloadPromises[r]:(t=$.Deferred(),i=this.imagesDownloadPromises[r]=t.promise(),o=new Image,o.onload=function(){return n.imagesDownloaded[r]=!0,t.resolve(o.src,e),n.imagesDownloadPromises[r]=null},o.onerror=function(){return t.reject(e),n.imagesDownloadPromises[r]=null},o.src=this.getImagePath(e),i)},o.prototype.getImagePathAndSize=function(e){var t,o;return _.defaults(e,{size:4,https:!0,ignoresConverting:!0}),t=this.getInternalImagePathAndSize(e),null==t&&(3===(o=e.size)||600===o?3!==e.size&&(e.size=3,t=this.getInternalImagePathAndSize(e)):4!==e.size&&(e.size=4,t=this.getInternalImagePathAndSize(e))),null==t&&(e.size=null,t=this.getInternalImagePathAndSize(e)),t},o.prototype.getInternalImagePathAndSize=function(e){var t,o,r,i,n,s;n=this.get("images");for(t in n)if(o=n[t],e.size===o.size||null==e.size)return r=e.https?null!=(s=o.https_url)?s:o.secure_url:o.url,i=o.size,e.ignoresConverting?r.match(/\/placeholder\//)?null:{path:r,size:i}:{path:r,size:i};return null},o.prototype.getImagePath=function(e){var t;return t=this.getImagePathAndSize(e),null!=t?t.path:void 0},o.prototype.getInternalImagePath=function(e){var t;return t=this.getInternalImagePathAndSize(e),null!=t?t.path:void 0},o.prototype.parse=function(e){var t;return null!=(t=e.photo)?t:e},o.prototype.isPublic=function(){return this.get("privacy")===!1},o.prototype.isPrivate=function(){return this.get("privacy")===!0},o.prototype.imageUrl=function(){var e;return e=this.getInternalImagePath({size:4,https:!0}),null!=e?e:this.get("images")[0].secure_url},o.prototype.isConverting=function(){return null!=this.get("converted")&&0===this.get("converted")||this.imageUrl().indexOf("/placeholder/")>=0},o.prototype.dimensionsForImageSize=function(e){var t,o,r,i;return i=this.get("width"),r=this.get("height"),null!=i&&null!=r?(i>r?(o=Math.min(i,e),t=Math.round(r*o/i)):(t=Math.min(r,e),o=Math.round(i*t/r)),{width:o,height:t}):void 0},o}(Backbone.Model)}.call(this),function(){var e,t,o={}.hasOwnProperty,r=function(e,t){function r(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};e=App.module("Models"),e.PhotoForViewer=function(e){function o(){return t=o.__super__.constructor.apply(this,arguments)}return r(o,e),o.prototype.isOwner=function(){return null!=App.currentUser&&App.currentUser.id===this.get("user_id")},o.prototype.getFavoriteState=function(){return!!this.get("favorited")},o.prototype.getFavoriteCount=function(){var e;return null!=(e=this.get("favorites_count"))?e:0},o.prototype.getFormatFavCount=function(){return this._formatNumber(this.getFavoriteCount())},o.prototype.getAbbreviateFavCount=function(){return this.abbreviateNumber(this.getFavoriteCount())},o.prototype.favorite=function(e){var t,o=this;return t=$.post("https://api.500px.com/v1/photos/"+this.id+"/favorite"),t.done(function(t){return o.set({favorites_count:o.get("favorites_count")+1,favorited:!0,rating:t.photo.rating,highest_rating:t.photo.highest_rating,highest_rating_date:t.photo.highest_rating_date}),"function"==typeof e?e(null,o.getFavoriteState()):void 0}).fail(function(){var t,r;return t=(r=App.Helpers.API).parseError.apply(r,arguments),"function"==typeof e?e(t,o.getFavoriteState()):void 0})},o.prototype.unfavorite=function(e){var t,o=this;return t=$.ajax({type:"DELETE",url:"https://api.500px.com/v1/photos/"+this.id+"/favorite"}),t.done(function(t){return o.set({favorites_count:o.get("favorites_count")-1,favorited:!1,rating:t.photo.rating,highest_rating:t.photo.highest_rating,highest_rating_date:t.photo.highest_rating_date}),"function"==typeof e?e(null,o.getFavoriteState()):void 0}).fail(function(){var t,r;return t=(r=App.Helpers.API).parseError.apply(r,arguments),"function"==typeof e?e(t,o.getFavoriteState()):void 0})},o.prototype.getLikeState=function(){return!!this.get("liked")},o.prototype.getLikeCount=function(){var e;return null!=(e=this.get("votes_count"))?e:0},o.prototype.getFormatLikeCount=function(){return this._formatNumber(this.getLikeCount())},o.prototype.getAbbreviateLikeCount=function(){return this.abbreviateNumber(this.getLikeCount())},o.prototype.like=function(e){var t,o=this;return t=$.post("https://api.500px.com/v1/photos/"+this.id+"/vote?"+$.param({vote:1})),t.done(function(t){var r;return o.set({votes_count:(null!=(r=o.get("votes_count"))?r:0)+1,liked:!0,rating:t.photo.rating,highest_rating:t.photo.highest_rating,highest_rating_date:t.photo.highest_rating_date}),"function"==typeof e?e(null,o.getLikeState()):void 0}).fail(function(){var t,r;return t=(r=App.Helpers.API).parseError.apply(r,arguments),"function"==typeof e?e(t,o.getLikeState()):void 0})},o.prototype.unlike=function(e){var t,o=this;return t=$.ajax({type:"DELETE",url:"https://api.500px.com/v1/photos/"+this.id+"/vote"}),t.done(function(t){var r;return o.set({votes_count:(null!=(r=o.get("votes_count"))?r:0)-1,liked:!1,rating:t.photo.rating,highest_rating:t.photo.highest_rating,highest_rating_date:t.photo.highest_rating_date}),"function"==typeof e?e(null,o.getLikeState()):void 0}).fail(function(){var t,r;return t=(r=App.Helpers.API).parseError.apply(r,arguments),"function"==typeof e?e(t,o.getLikeState()):void 0})},o.prototype.getUrl=function(){return this.getCanonicalUrl()},o.prototype.getCanonicalUrl=function(){return"https://500px.com"+this.get("url")},o.prototype.shouldSubmitSharelizerCounts=function(){return!0},o.prototype.submitSharelizerCounts=function(e){return $.post("https://api.500px.com/v1/photos/"+this.id+"/sharelizer_counts",e)},o.prototype._formatNumber=function(e){var t,o;for(t=e.toString(),o=/(\d+)(\d{3})/;o.test(t);)t=t.replace(o,"$1,$2");return t},o.prototype.abbreviateNumber=function(e,t){var o,r,i;if(null==t&&(t=1e3),i=["","k","m","b","t"],r=0>e?"-":"",e=Math.abs(e),t>e)return""+e;for(o=0;e>=1e3&&null!=i[o+1];)e/=1e3,o+=1;return e=parseInt(10*e+.5,10)/10,""+r+e+i[o]},o}(App.Models.Photo)}.call(this),function(){var e,t,o,r,i={}.hasOwnProperty,n=function(e,t){function o(){this.constructor=e}for(var r in t)i.call(t,r)&&(e[r]=t[r]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e},s=function(e,t){return function(){return e.apply(t,arguments)}},a=[].indexOf||function(e){for(var t=0,o=this.length;o>t;t++)if(t in this&&this[t]===e)return t;return-1};t=App.module("Photos.Models"),t.PhotoMembership=function(e){function t(){return o=t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.initialize=function(e,o){var r,i,n;null==o&&(o={}),i={id:e.id};for(r in e)n=e[r],/^membership\_attr\_/.test(r)&&(i[r]=n);for(r in i)n=i[r],"id"!==r&&delete e[r];return this.photo=App.Photos.Models.PhotoManager.createOrUpdateModel(e),t.__super__.initialize.call(this,i,o)},t.prototype.toJSON=function(){return this.photo.toJSON()},t.prototype.getPhoto=function(){return this.photo},t}(Backbone.Model),t.Photo=function(e){function t(){return this.reportContent=s(this.reportContent,this),r=t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.SHARELIZER_IMAGE_SIZE=2048,t.prototype.CATEGORIES={10:"Abstract",11:"Animals",5:"Black and White",1:"Celebrities",9:"City & Architecture",15:"Commercial",16:"Concert",20:"Family",14:"Fashion",2:"Film",24:"Fine Art",23:"Food",3:"Journalism",8:"Landscapes",12:"Macro",18:"Nature",4:"Nude",7:"People",19:"Performing Arts",17:"Sport",6:"Still Life",21:"Street",26:"Transportation",13:"Travel",22:"Underwater",27:"Urban Exploration",25:"Wedding",0:"Uncategorized"},t.prototype.PRICES={contributor:{web:35,royalty_free:150,resale:300},curated:{web:50,royalty_free:250,resale:750}},t.prototype.LICENSES={web:{dpi:72,minResolution:0,friendlyKey:"web-ready",showPrint:!1,utmContent:"web social license button"},royalty_free:{dpi:300,minResolution:3e3,friendlyKey:"print-ready",showPrint:!0,utmContent:"rf license button"},resale:{dpi:300,minResolution:3e3,friendlyKey:"products-for-resale",showPrint:!0,utmContent:"resale license button"}},t.prototype.LICENSE_URLS={0:"https://500px.com/terms",1:"https://creativecommons.org/licenses/by-nc/3.0/",2:"https://creativecommons.org/licenses/by-nc-nd/3.0/",3:"https://creativecommons.org/licenses/by-nc-sa/3.0/",4:"https://creativecommons.org/licenses/by/3.0/",5:"https://creativecommons.org/licenses/by-nd/3.0/",6:"https://creativecommons.org/licenses/by-sa/3.0/"},t.prototype.LICENSE_NAMES={0:"Standard 500px License",1:"Attribution-NonCommercial 3.0",2:"Attribution-NonCommercial-NoDerivs 3.0",3:"Attribution-NonCommercial-ShareAlike 3.0",4:"Attribution 3.0",5:"Attribution-NoDerivs 3.0",6:"Attribution-ShareAlike 3.0"},t.prototype.LICENSING_STATUS={PRIME:3,EDITORIAL:6,SUBPRIME:5,SUBEDITORIAL:7,SUBMITTED:2,PRESUBMITTED:9,NONE:0,ILLEGAL:8,PENDING:4,RIGHTS_MANAGED:10,REMOVED:1},t.prototype.WEB_READY_LONGEST_EDGE=1500,t.prototype.RIGHTS_MANAGED_LICENSERS={1171535:function(e){return"https://500pxprime.wufoo.com/forms/z1u7fcjf1s2l8aq/def/Field9="+e},10156355:function(e){return"https://500pxprime.wufoo.com/forms/qqylu8s0t6pfeb/def/Field9="+e}},t.prototype.url=function(){return"https://webapi.500px.com/photos/"+this.id},t.prototype.initialize=function(e,o){if(null==o&&(o={}),this._commentsData=o.commentsData,this.fromCacheManager=o.fromCacheManager,!this.fromCacheManager)throw new Error("Photo objects should be managed by App.Photos.Models.PhotoManager");return t.__super__.initialize.apply(this,arguments)},t.prototype.hasGeoCoords=function(){return!0},t.prototype.geoCoords=function(){var e,t;return null!=(t=this.get("longitude"))&&null!=(e=this.get("latitude"))?{longitude:t,latitude:e}:null},t.prototype.setAsCover=function(){var e,t,o,r=this;if(!this._settingCover)return this._settingCover=!0,this.trigger("cover:setting"),o="https://media.500px.com/upload/user/cover",o+="?"+$.param({user_id:App.currentUser.id,authenticity_token:PxApp.csrf_token}),e=new FormData,e.append("source_photo_id",this.id),t=$.ajax({type:"POST",url:o,data:e,processData:!1,contentType:!1,cache:!1}),t.done(function(){return r.set("is_cover",!0),r.trigger("cover:succeeded")}).fail(function(){return r.trigger("cover:failed")}).always(function(){return r._settingCover=!1}),t},t.prototype.canBeCover=function(){var e,t;return null==(t=this.get("width"))||null==(e=this.get("height"))?!1:t>=2e3&&e>=1e3},t.prototype.reportContent=function(e,t){var o,r,i=this;return null==t&&(t=""),r={reason:e},"0"===e&&(r.reason_details=t),o=$.post("https://api.500px.com/v1/photos/"+this.id+"/report",r),o.done(function(){return i._contentReported=!0,i._contentReportReason=e,$.cookie("reported-this-photo-"+i.id,"1"),i.trigger("contentReported",e)}),o},t.prototype.contentReported=function(){var e;return!!(null!=(e=this._contentReported)?e:"1"===$.cookie("reported-this-photo-"+this.id))},t.prototype.contentReportReason=function(){return this._contentReportReason},t.prototype.isEditorsChoice=function(){return!!this.get("editors_choice")},t.prototype.canBeEditorsChoice=function(){return App.currentUser?App.currentUser.id!==this.get("user_id")&&!this.get("nsfw"):!1},t.prototype.submitLicensingRequest=function(){var e,t=this;if(App.currentUser)return e=$.post("https://api.500px.com/v1/photos/"+this.id+"/licensing_request"),e.done(function(){return t.set({licensing_requested:!0})}),e},t.prototype.submitEditorsChoice=function(){var e,t=this;if(App.currentUser&&!this.isEditorsChoice())return e=$.post("https://api.500px.com/v1/editors/photos/"+this.id+"/editors_choice"),e.done(function(){return t.set({editors_choice:!0,editors_choice_date:Date.now(),editored_by:{fullname:App.currentUser.get("fullname"),user_id:App.currentUser.id}})}),e},t.prototype.removeEditorsChoice=function(){var e,t=this;if(App.currentUser&&this.isEditorsChoice())return e=$.ajax({type:"DELETE",url:"https://api.500px.com/v1/editors/photos/"+this.id+"/editors_choice"}),e.done(function(){return t.set({editors_choice:!1,editors_choice_date:null,editored_by:null})}),e},t.prototype.resolution=function(e){var t,o,r,i,n,s,a,l;return s=this.get("store_width")||this.get("width"),n=this.get("store_height")||this.get("height"),l=[s,n],a=l[0],o=l[1],"web"===e&&(s>=n?(a=this.WEB_READY_LONGEST_EDGE,o=Math.round(n*a/s)):(o=this.WEB_READY_LONGEST_EDGE,a=Math.round(s*o/n))),t=this.LICENSES[e].dpi,i=Math.floor(a/t*10)/10,r=Math.floor(o/t*10)/10,{width:a,height:o,printWidth:i,printHeight:r}},t.prototype.isAvailableForImmediatePurchase=function(){var e;return e=this.get("licensing_status"),null==e?!1:_.contains([this.LICENSING_STATUS.PRIME,this.LICENSING_STATUS.SUBPRIME,this.LICENSING_STATUS.EDITORIAL,this.LICENSING_STATUS.SUBEDITORIAL],e)},t.prototype.isSubmitted=function(){return _.contains([this.LICENSING_STATUS.SUBMITTED,this.LICENSING_STATUS.PRESUBMITTED],this.get("licensing_status"))},t.prototype.isUnderSubmission=function(){var e;return e=this.get("licensing_status"),null==e?!1:_.contains([this.LICENSING_STATUS.SUBMITTED,this.LICENSING_STATUS.PRESUBMITTED,this.LICENSING_STATUS.PENDING],e)},t.prototype.sizeRequirementsMet=function(e,t,o){return _.max([e,t])>=this.LICENSES[o].minResolution},t.prototype.getLicenseTypes=function(){var e,t=this;return e=_.extend({},this.LICENSES),_.each(e,function(o,r){var i;return _.extend(e[r],t.resolution(r)),i={sizeRequirementsMet:t.sizeRequirementsMet(e[r].width,e[r].height,r),isLicenseEnabled:t.isLicenseEnabled(r),isDefault:r===t.getDefaultLicenseType(),price:t.getPrice(r)},_.extend(e[r],i)}),e},t.prototype.getLicenseName=function(){var e;return e=this.get("license_type"),this.LICENSE_NAMES[e]},t.prototype.isContributorCollection=function(){return!this.isCuratedCollection()},t.prototype.isCuratedCollection=function(){var e;return(e=this.get("licensing_status"))===this.LICENSING_STATUS.PRIME||e===this.LICENSING_STATUS.EDITORIAL},t.prototype.getPrice=function(e){var t,o,r,i,n;return t="contributor",this.isCuratedCollection()&&(t="curated"),r=this.PRICES[t][e],(null!=(i=App.currentUser)?null!=(n=i.get("custom_license_prices"))?n.length:void 0:void 0)&&(o=_.find(App.currentUser.get("custom_license_prices"),function(o){return o.available&&o.collection_type===t&&o.license_type===e}),null!=o&&(r=o.price/100)),r},t.prototype.isAccountRestricted=function(e){var t,o,r,i;return(null!=(r=App.currentUser)?null!=(i=r.get("custom_license_prices"))?i.length:void 0:void 0)?(t="contributor",this.isCuratedCollection()&&(t="curated"),o=_.find(App.currentUser.get("custom_license_prices"),function(o){return!o.available&&o.collection_type===t&&o.license_type===e}),!!o):!1},t.prototype.isLicenseEnabled=function(e){var t,o,r;return o=this.LICENSES[e],r=!this.isAvailableForImmediatePurchase()||this.isAvailableForImmediatePurchase&&this.sizeRequirementsMet(o.width,o.height,e),t=this.isAccountRestricted(e),r&&!t},t.prototype.getDefaultLicenseType=function(){var e,t;if(!this.isRightsManaged())return t=["royalty_free","web","resale"],e=_.find(t,this.isLicenseEnabled,this)},t.prototype.licenseUrl=function(e,t){var o;return null==t&&(t=""),o={utm_source:"500px",utm_content:this.LICENSES[e].utmContent,utm_term:t,utm_medium:"referral",utm_campaign:"photo page",license_type:e},"https://marketplace.500px.com/checkout/"+this.id+"?"+$.param(o)},t.prototype.compUrl=function(){return"https://marketplace.500px.com/photos/"+this.id+"/comp"},t.prototype.isExclusive=function(){var e;return e=this.get("licensing_status"),null==e?!1:_.contains([this.LICENSING_STATUS.NONE,this.LICENSING_STATUS.REMOVED,this.LICENSING_STATUS.ILLEGAL,this.LICENSING_STATUS.PENDING,this.LICENSING_STATUS.RIGHTS_MANAGED],e)?!1:"exclusive"===this.get("licensing_type")},t.prototype.isEditorial=function(){return _.contains([this.LICENSING_STATUS.EDITORIAL,this.LICENSING_STATUS.SUBEDITORIAL],this.get("licensing_status"))},t.prototype.isModelReleased=function(){var e;return e=this.get("releases"),null==e?!1:!!_.find(e,function(e){return"model"===e.type})},t.prototype.isLocationReleased=function(){var e;return e=this.get("releases"),null==e?!1:!!_.find(e,function(e){return"location"===e.type})},t.prototype.isPurchasable=function(){var e;return e=this.get("licensing_status"),null==e?!0:!_.contains([this.LICENSING_STATUS.REMOVED,this.LICENSING_STATUS.ILLEGAL],e)},t.prototype.isSubmittable=function(){var e;return e=this.get("licensing_status"),null==e?!0:!_.contains([this.LICENSING_STATUS.ILLEGAL],e)},t.prototype.isRequestable=function(){return this.get("license_requests_enabled")},t.prototype.isStoreEnabled=function(){var e;return!!(null!=(e=this.getUser())?e.get("store_on"):void 0)},t.prototype.isRightsManaged=function(){var e;return e=String(this.get("user_id")),a.call(_.keys(this.RIGHTS_MANAGED_LICENSERS),e)>=0?!0:this.get("licensing_status")===this.LICENSING_STATUS.RIGHTS_MANAGED},t.prototype.getRightsManagedFormUrl=function(){var e;if(e=this.get("user_id"),null!=this.RIGHTS_MANAGED_LICENSERS[e])return this.RIGHTS_MANAGED_LICENSERS[e](this.id);throw new Error("unknown rights managed user")},t.prototype.isDownloadable=function(){return this.isStoreEnabled()?this.isOwner()?this.isSubmittable():this.isCreativeCommonsCompatible()?!0:this.isAvailableForImmediatePurchase()?!0:this.isRequestable()?this.isPurchasable():this.isUnderSubmission():!1},t.prototype.isCreativeCommonsCompatible=function(){var e;return e=this.get("license_type"),null!=e&&0!==e},t.prototype.getCreativeCommonsLicenseUrl=function(){var e;return this.isCreativeCommonsCompatible()?(e=this.get("license_type"),this.LICENSE_URLS[e]):void 0},t.prototype.getCreativeCommonsPhotoUrl=function(){return this.isCreativeCommonsCompatible()?this.imageUrl():void 0},t.prototype.getComments=function(){return null!=this._comments?this._comments:this._comments=new App.Photos.Collections.Comments(null!=this._commentsData?this._commentsData:!1,{photo:this})},t.prototype.like=function(){var e,o=this;return e=t.__super__.like.apply(this,arguments),e.done(function(){var e,t;return e=o.getLikedByUsers(),null!=e.totalItems?(t=$.Deferred().resolve(),e.totalItems+=1,App.Photos.Models.UserManager.getModelById(App.currentUser.id,{noFetch:!0})||App.Photos.Models.UserManager.createOrUpdateModel(App.currentUser.toJSON()),e.add(new App.Photos.Models.UserMembership({id:App.currentUser.id}),{at:0})):t=e.fetch(),t.done(function(){return o.trigger("change:likedByCurrentUser")})})},t.prototype.unlike=function(){var e,o=this;return e=t.__super__.unlike.apply(this,arguments),e.done(function(){var e,t;return e=o.getLikedByUsers(),null!=e.totalItems?(e.totalItems-=1,t=e.findWhere({id:App.currentUser.id}),null!=t&&e.remove(t),o.trigger("change:likedByCurrentUser")):void 0})},t.prototype.favorite=function(){var e,o=this;return e=t.__super__.favorite.apply(this,arguments),e.done(function(){var e,t;return e=o.getFavoritedByUsers(),null!=e.totalItems?(t=$.Deferred().resolve(),e.totalItems+=1,App.Photos.Models.UserManager.getModelById(App.currentUser.id,{noFetch:!0})||App.Photos.Models.UserManager.createOrUpdateModel(App.currentUser.toJSON()),e.add(new App.Photos.Models.UserMembership({id:App.currentUser.id}),{at:0})):t=e.fetch(),t.done(function(){return o.trigger("change:favoritedByCurrentUser")})})},t.prototype.unfavorite=function(){var e,o=this;return e=t.__super__.unfavorite.apply(this,arguments),e.done(function(){var e,t;return e=o.getFavoritedByUsers(),null!=e.totalItems?(e.totalItems-=1,t=e.findWhere({id:App.currentUser.id}),null!=t&&e.remove(t),o.trigger("change:favoritedByCurrentUser")):void 0})},t.prototype.getFavoritedByUsers=function(){return null!=this._favoritedByUsers?this._favoritedByUsers:this._favoritedByUsers=new App.Photos.Collections.FavoritedByUsers(!1,{photo:this})},t.prototype.getLikedByUsers=function(){return null!=this._likedByUsers?this._likedByUsers:this._likedByUsers=new App.Photos.Collections.LikedByUsers(!1,{photo:this})},t.prototype.getRelatedPhotos=function(){return null!=this._relatedPhotos?this._relatedPhotos:this._relatedPhotos=new App.Photos.Collections.RelatedPhotos(!1,{photoId:this.id})},t.prototype.getUser=function(){return null!=this._user?this._user:this._user=App.Photos.Models.UserManager.getModelById(this.get("user_id"),{noFetch:!0})},t.prototype.getCamera=function(){var e,t,o=this;return e=$.Deferred(),null==this.get("camera")?e.resolve(!1):null!=this._camera?e.resolve(this._camera):(t=$.get("https://webapi.500px.com/camera/lookup/"+this.get("camera")),t.done(function(t){return t.cameras.length>0?(o._camera=new Backbone.Model(t.cameras[0]),e.resolve(o._camera)):(o._camera=!1,e.resolve(o._camera))})),e},t.prototype.toJSON=function(){return _.extend(t.__super__.toJSON.apply(this,arguments),{user:this.getUser().toJSON()})
},t.prototype.share=function(e){return null==this.popup&&(this.popup=new App.Lib.Sharelizer({url:this.getCanonicalUrl(),category:"Photo Page"})),this[e]()},t.prototype.google=function(){return this.popup.google()},t.prototype.facebook=function(){return this.popup.facebook()},t.prototype._pinterestShareData=function(){return{media:this.getImagePath({size:this.SHARELIZER_IMAGE_SIZE}),description:""+this.get("name")+" - "+this.get("description")}},t.prototype.pinterest=function(){var e;if(e=this._pinterestShareData(),!e.media||!e.description)throw"This view doesn't know how to share with pinterest";return this.popup.pinterest(e.media,e.description)},t.prototype._twitterShareData=function(){var e,t,o,r;return t=this.get("name"),o=null!=(r=this.getUser().get("contacts"))?r.twitter:void 0,e=this.getUser().get("fullname"),o?{text:'"'+t+'" by @'+o+"."}:{text:'"'+t+'" by '+e+"."}},t.prototype.twitter=function(){var e;if(e=this._twitterShareData(),!e.text)throw"This view doesn't know how to share with twitter";return this.popup.twitter(e.text)},t.prototype._stumbleuponShareData=function(){return{title:'Photo "'+this.get("name")+'" by '+this.getUser().get("fullname")}},t.prototype.stumbleupon=function(){var e;if(e=this._stumbleuponShareData(),!e.title)throw"This view doesn't know how to share with StumbleUpon";return this.popup.stumbleupon(e)},t.prototype.getCategoryText=function(){return this.CATEGORIES[this.get("category")]},t}(App.Models.PhotoForViewer),e=function(){function e(){}return e.prototype.MAX_BATCH_SIZE=50,e.prototype.BATCH_INTERVAL=200,e.prototype.cache={},e.prototype.fetchingPromises={},e.prototype.createOrUpdateModel=function(e){var t,o;return t=e.id,o=this.cache[t],null==o&&(o=this.cache[t]=new App.Photos.Models.Photo({},{fromCacheManager:!0})),this._updateModelAttributes(o,e),o},e.prototype._updateModelAttributes=function(e,t){var o,r,i,n,s,a,l;if(t.user&&(i=t.user,App.Photos.Models.UserManager.createOrUpdateModel(i),delete t.user),t.images){for(o=null!=(a=e.get("images"))?a:[],l=t.images,n=0,s=l.length;s>n;n++)r=l[n],null==e.getInternalImagePath({size:r.size,ignoresConverting:!0})&&o.push(r);e.set("images",o),delete t.images}return e.set(t)},e.prototype._apiParams=function(){return{image_size:["1","20","21","31","4","1080","1600","2048"],include_tags:!0,include_licensing:!0,include_releases:!0,expanded_user_info:!0,is_following:!0}},e.prototype.prefetchModels=function(e,t){var o,r,i,n,s;for(null==t&&(t={}),i=[],n=0,s=e.length;s>n;n++)o=e[n],r=this.cache[o],this._shouldFetch(r,t)&&(this.fetchingPromises[o]||i.push(o));return i.length>0?t.batchable?this._startBatchedPrefetch(i):this._internalPrefetchModels(i):void 0},e.prototype._startBatchedPrefetch=function(e){var t=this;return null==this.batchedPhotoIds&&(this.batchedPhotoIds=[]),this.batchedPhotoIds=this.batchedPhotoIds.concat(e),this.batchedPhotoIds.length>=this.MAX_BATCH_SIZE?this._processQueuedPrefetch():(null==this._throtted&&(this._throtted=_.throttle(function(){return t._processQueuedPrefetch()},this.BATCH_INTERVAL,{leading:!1,trailing:!0})),this._throtted())},e.prototype._processQueuedPrefetch=function(){var e,t,o,r,i;if(this.batchedPhotoIds.length){for(t=[],i=this.batchedPhotoIds,o=0,r=i.length;r>o;o++)e=i[o],a.call(t,e)<0&&(this.fetchingPromises[e]||t.push(e));return this.batchedPhotoIds=[],this._internalPrefetchModels(t)}},e.prototype._internalPrefetchModels=function(e){var t,o,r,i,n,s,a=this;for(o={},n=0,s=e.length;s>n;n++){if(r=e[n],null!=this.fetchingPromises[r])throw new Error("Found an existing promise object for photo-"+r);t=$.Deferred(),this.fetchingPromises[r]=t.promise(),o[r]=t}return i=_.extend(this._apiParams(),{ids:e.join(",")}),$.get("https://api.500px.com/v1/photos?"+$.param(i)).done(function(e){var i,n,s,l;l=[];for(r in o)t=o[r],null!=(i=null!=e?null!=(s=e.photos)?s[r]:void 0:void 0)?(n=a.createOrUpdateModel(i),t.resolve(n)):t.reject("__error::error"),l.push(delete a.fetchingPromises[r]);return l}).fail(function(){var e,i,n;e=(i=App.Helpers.API).parseError.apply(i,arguments),n=[];for(r in o)t=o[r],t.reject(e),n.push(delete a.fetchingPromises[r]);return n})},e.prototype._shouldFetch=function(e,t){var o,r;return null==t&&(t={}),o=null==e,t.favoriteAndLikeStates&&(o||(o=null==e.get("favorited")||null==e.get("liked"))),t.licensingStates&&(o||(o=null==e.get("licensing_status"))),t.userFollowingStates&&(o||(o=null==(r=e.getUser())),o||(o=!r.isSelf()&&null==r.get("following"))),o},e.prototype.getCachedModelById=function(e){return this.cache[e]},e.prototype.getModelById=function(e,t){var o,r,i,n,s=this;return null==t&&(t={}),i=this.cache[e],t.noFetch?$.Deferred().resolve(i).promise():(this._shouldFetch(i,t)?null!=this.fetchingPromises[e]?n=this.fetchingPromises[e]:(o=$.Deferred(),n=this.fetchingPromises[e]=o.promise(),r=_.extend(this._apiParams(),{ids:e}),$.get("https://api.500px.com/v1/photos?"+$.param(r)).done(function(t){var r,n;return null!=(r=null!=t?null!=(n=t.photos)?n[e]:void 0:void 0)?(i=s.createOrUpdateModel(r),o.resolve(i)):o.reject("__error::error"),delete s.fetchingPromises[e]}).fail(function(){var t,r;return t=(r=App.Helpers.API).parseError.apply(r,arguments),o.reject(t),delete s.fetchingPromises[e]})):n=$.Deferred().resolve(i).promise(),n)},e}(),null==t.PhotoManager&&(t.PhotoManager=new e)}.call(this),function(){var e,t,o={}.hasOwnProperty,r=function(e,t){function r(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},i=[].indexOf||function(e){for(var t=0,o=this.length;o>t;t++)if(t in this&&this[t]===e)return t;return-1};e=App.module("Collections"),e.InfiniteCollection=function(e){function o(){return t=o.__super__.constructor.apply(this,arguments)}return r(o,e),o.prototype.page=null,o.prototype.rpp=20,o.prototype.fetching=function(){return this._inProgress===!0},o.prototype.initialize=function(e,t){return null==e&&(e=[]),null==t&&(t={}),null==t.page&&(t.page=1),null!=t.page&&(this.page=0|t.page),null!=t.rpp&&(this.rpp=0|t.rpp),this._firstPage=this.page},o.prototype._resetState=function(){return this.page=null,this.totalPages=null,this._done=!1,this._singlePage=!1,this._inProgress=!1},o.prototype.reset=function(e,t){var r;return null==e&&(e=[]),null==t&&(t={}),this.trigger("before:reset"),this._resetState(),this.page=null!=(r=t.page)?r:1,e.length>0&&(this.page=1,e.length<this.rpp&&(this.totalPages=1,this._done=!0,this._singlePage=!0)),o.__super__.reset.apply(this,arguments)},o.prototype.getFirstPage=function(){return this._firstPage},o.prototype.fetch=function(e){var t,r,n,s,a=this;return null==e&&(e={}),null==this.page&&(this.page=1),s=$.isFunction(this.url)?this.url():this.url,n=i.call(s,"?")>=0?"&":"?",r=e.previousPage?this._firstPage:this.page,s=""+s+n+"page="+r+"&rpp="+this.rpp,this._inProgress=!0,t=_.extend({},{url:s,remove:!1},_.omit(e,"page")),o.__super__.fetch.call(this,t).done(function(){return a.totalPages>0&&a._firstPage>a.totalPages?(a._firstPage=a.page=a.totalPages,App.vent.trigger("pagination:overflow",a.totalPages),a.trigger("pagination:overflow",a.totalPages),a.fetch().done(function(){return a.trigger("pagination:overflow:refetched",a.totalPages)})):a._inProgress=!1})},o.prototype.nextPage=function(){var e,t=this;return e=$.Deferred(),this._inProgress||this._done?e.resolve(this.page,this._done).promise():(this._inProgress=!0,(null==this.totalPages||this.page<this.totalPages)&&(this.page+=1),this.fetch().done(function(){return e.resolve(t.page,t._done)}),e.promise())},o.prototype.previousPage=function(){var e,t=this;return e=$.Deferred(),this._inProgress||1===this._firstPage?e.resolve(this._firstPage,1===this._firstPage).promise():(this._inProgress=!0,this._firstPage-=1,this.fetch({previousPage:!0}).done(function(){return e.resolve(t._firstPage,1===t._firstPage)}),e.promise())},o.prototype._extractModels=function(e){var t,o,r;o=["meta","total_pages","current_page","feature","total_items","total_pages"];for(t in e)if(r=e[t],i.call(o,t)<0)return r},o.prototype.finished=function(){return this._done===!0},o.prototype.singlePage=function(){return this._singlePage===!0},o.prototype.parse=function(e){return null!=e.meta?(this._just_parsed_page=e.meta.pagination.page,this.totalPages!==e.meta.pagination.total_pages&&(this.totalPages=e.meta.pagination.total_pages,this.trigger("pagination:page_count_update",this.totalPages)),this.totalItems!==e.meta.pagination.total_items&&(this.totalItems=e.meta.pagination.total_items,this.trigger("pagination:item_count_update",this.totalItems))):(this._just_parsed_page=e.current_page,this.totalPages!==e.total_pages&&(this.totalPages=e.total_pages,this.trigger("pagination:page_count_update",this.totalPages)),this.totalItems!==e.total_items&&(this.totalItems=e.total_items,this.trigger("pagination:item_count_update",this.totalItems))),this._just_parsed_page>this.page&&(this.page=this._just_parsed_page),this.page>=this.totalPages&&(this._done=!0,this.trigger("pagination:end")),this._extractModels(e)},o}(Backbone.Collection)}.call(this),function(){var e,t={}.hasOwnProperty,o=function(e,o){function r(){this.constructor=e}for(var i in o)t.call(o,i)&&(e[i]=o[i]);return r.prototype=o.prototype,e.prototype=new r,e.__super__=o.prototype,e},r=[].indexOf||function(e){for(var t=0,o=this.length;o>t;t++)if(t in this&&this[t]===e)return t;return-1};e=App.module("Photos.Collections"),e.NavigationalInfiniteCollection=function(e){function t(e,o){var r;null==o&&(o={}),this.navigationDisabled=null!=(r=o.navigationDisabled)?r:!1,this.navigationDisabled||(this.comparator="membership_attr_nav_offset"),t.__super__.constructor.apply(this,arguments)}return o(t,e),t.prototype.FETCH_MORE_THRESHOLD=5,t.prototype.photoAt=function(){throw new Error("Not implemented!")},t.prototype._getPhotoIds=function(){throw new Error("Not implemented!")},t.prototype._contextUrlParams=function(){throw new Error("Not implemented!")},t.prototype._extractPhotoIdFromItem=function(){throw new Error("Not implemented!")},t.prototype._buildDisplayedItemData=function(){throw new Error("Not implemented!")},t.prototype.shouldHideRelatedPhotos=function(){throw new Error("Not implemented!")},t.parseBrowserUrlParams=function(e){var t,o,r;return t={contextName:e},o=null!=(r=App.controller.tidyIntParam("ctx_page"))?r:1,0>=o&&(o=1),t.page=o,t},t.prototype.initialize=function(e,o){var r=this;return null==o&&(o={}),t.__super__.initialize.apply(this,arguments),this.navigationDisabled?void 0:(o.contextHash&&(this._selectedPhotoPage=this._firstPage=this.page=o.contextHash.page,this._displayedPhoto=o.contextHash.displayedPhoto),this.listenToOnce(this,"pagination:overflow:refetched",function(e){var t,o;if(null!=r._displayedPhotoId){if(o=r._getPhotoIds().indexOf(r._displayedPhotoId),null==o)throw new Error("Cannot find the injected photo in nav context!");return t=r.at(o),t.set({membership_attr_nav_page:e,membership_attr_nav_intra_page_offset:0,membership_attr_nav_offset:(e-1)*(r.rpp+1)},{silient:!0}),1!==e?r.previousPage():void 0}}))},t.prototype.buildBrowserUrlParams=function(){if(this.navigationDisabled)throw new Error("navigation is disabled");return _.extend({ctx_page:this._selectedPhotoPage},this._contextUrlParams())},t.prototype.selectedPhotoOffset=function(){if(this.navigationDisabled)throw new Error("navigation is disabled");return this._selectedPhotoId?this._getPhotoIds().indexOf(this._selectedPhotoId):-1},t.prototype.selectPhoto=function(e){var t;if(this.navigationDisabled)throw new Error("navigation is disabled");switch(t=this._internalSelectPhoto(e)){case 1:return this.nextPage();case-1:return this.previousPage()}},t.prototype._internalSelectPhoto=function(e){var t,o,r,i,n;if(this._selectedPhotoId!==e.id){if(r=this._getPhotoIds(),t=r.indexOf(e.id),null==t)throw new Error("Cannot find the newly selected photo in nav context!");return this._selectedPhotoId=e.id,i=this.at(t),this._selectedPhotoPage=i.get("membership_attr_nav_page"),n=i.get("membership_attr_nav_intra_page_offset"),n<=this.FETCH_MORE_THRESHOLD?(o=this.getFirstPage(),1===o?!1:this._selectedPhotoPage-1>=o?!1:-1):n>this.rpp-this.FETCH_MORE_THRESHOLD?this.finished()?!1:this._selectedPhotoPage+1<=this.page?!1:1:!1}},t.prototype.parse=function(e){var o,i,n,s,a,l,p,u,h;return e=t.__super__.parse.call(this,e),this.navigationDisabled?e:(n=null!=(h=this._displayedPhoto)?h.id:void 0,a=null==n,i=(this._just_parsed_page-1)*(2*this.rpp+1),s=this._getPhotoIds(),o=function(){var t,o,h;for(h=[],l=t=0,o=e.length;o>t;l=++t)p=e[l],u=this._extractPhotoIdFromItem(p),r.call(s,u)>=0||(s.unshift(u),p.membership_attr_nav_page=this._just_parsed_page,p.membership_attr_nav_intra_page_offset=l+1,p.membership_attr_nav_offset=i+p.membership_attr_nav_intra_page_offset,a||(a=u===n),h.push(p));return h}.call(this),a||(p=this._buildDisplayedItemData(this._displayedPhoto),p.membership_attr_nav_page=this._just_parsed_page,p.membership_attr_nav_intra_page_offset=0,p.membership_attr_nav_offset=i,o.unshift(p),this._displayedPhotoId=this._displayedPhoto.id),this._displayedPhoto=null,o)},t}(App.Collections.InfiniteCollection)}.call(this),function(){var e,t,o={}.hasOwnProperty,r=function(e,t){function r(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};e=App.module("Galleries.Collections"),e.GalleryPhotos=function(e){function o(){return t=o.__super__.constructor.apply(this,arguments)}return r(o,e),o.prototype.rpp=50,o.prototype.model=App.Photos.Models.PhotoMembership,o.prototype.initialize=function(e,t){return o.__super__.initialize.apply(this,arguments),t.contextHash?(this.galleryPath=t.contextHash.galleryPath,this.userId=t.contextHash.userId):(this.galleryPath=t.galleryPath,this.userId=t.userId)},o.prototype.url=function(){var e;return e={rpp:this.rpp,image_size:["1","20","21","31","4","1080","1600","2048"],formats:"jpeg,lytro",sort:"position",sort_direction:"asc"},"https://api.500px.com/v1/users/"+this.userId+"/galleries/"+this.galleryPath+"/items?"+$.param(e)},o.prototype.parse=function(e){var t;return t={photos:e.photos,meta:{pagination:{page:e.current_page,total_items:e.total_items,total_pages:e.total_pages}}},o.__super__.parse.call(this,t)},o.prototype.photoAt=function(e){return this.at(e).getPhoto()},o.prototype.reorder=function(e,t){var o,r;return r="https://api.500px.com/v1/users/"+this.userId+"/galleries/"+this.galleryPath+"/items",o={add:{after:{id:t},photos:[e]}},$.ajax({url:r,type:"PUT",data:o})},o.prototype._getPhotoIds=function(){return this.pluck("id")},o.prototype._buildDisplayedItemData=function(e){return e.toJSON()},o.prototype._extractPhotoIdFromItem=function(e){return e.id},o.parseBrowserUrlParams=function(){var e,t;return e=o.__super__.constructor.parseBrowserUrlParams.apply(this,arguments),e.galleryPath=App.controller._loadPageVar("galleryPath"),e.userId=null!=(t=App.controller.tidyIntParam("user_id"))?t:-1,null!=e.galleryPath&&e.userId>0?e:null},o.prototype._contextUrlParams=function(){return{from:"gallery",galleryPath:this.galleryPath,user_id:this.userId}},o.prototype.shouldHideRelatedPhotos=function(){return!1},o}(App.Photos.Collections.NavigationalInfiniteCollection)}.call(this),function(){var e,t,o={}.hasOwnProperty,r=function(e,t){function r(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};e=App.module("Models"),e.Gallery=function(e){function o(){return t=o.__super__.constructor.apply(this,arguments)}return r(o,e),o.prototype.GALLERY_KINDS={KIND_GENERAL:0,KIND_LIGHTBOX:4,KIND_LICENSING_GALLERY:4,KIND_PORTFOLIO:4,KIND_PROFILE:3},o.prototype.isEmpty=function(){return 0===this.get("items_count")},o.prototype.containsOwnerPhotosOnly=function(){var e;return(e=this.get("kind"))===this.GALLERY_KINDS.KIND_PROFILE||e===this.GALLERY_KINDS.KIND_PORTFOLIO},o.prototype.isPrivate=function(){return this.get("privacy")},o.prototype.markPhotoMembership=function(e,t){return null==t&&(t={}),null==this._memberPhotoIds&&(this._memberPhotoIds={}),this._memberPhotoIds[e]=!0,t.silent?void 0:this.trigger("change:photoMembership",e,!0)},o.prototype.containsPhoto=function(e){return null==this._memberPhotoIds&&(this._memberPhotoIds={}),e.id in this._memberPhotoIds},o.prototype.getCoverPhotoId=function(){var e;return null!=(e=this.getCoverPhoto())?e.id:void 0},o.prototype.getCoverPhoto=function(){var e;return null!=(e=this.get("cover_photo"))?e[0]:void 0},o.prototype.setCover=function(e){var t,o=this;return t={_method:"put",cover_photo_id:e,cover_size:2048},$.post("https://api.500px.com/v1/users/"+this.get("user_id")+"/galleries/"+this.get("id"),t).done(function(e){return o.set("cover_photo",e.gallery.cover_photo)})},o.prototype.addPhotos=function(e){var t,o,r=this;return o={_method:"put",add:{photos:function(){var o,r,i;for(i=[],o=0,r=e.length;r>o;o++)t=e[o],i.push(t.id);return i}()}},$.post("https://api.500px.com/v1/users/"+this.get("user_id")+"/galleries/"+this.get("id")+"/items",o).done(function(o){var i,n,s;for(i=0,n=e.length;n>i;i++)t=e[i],"added"===(null!=(s=o[t.id])?s.result:void 0)&&(null==r._memberPhotoIds&&(r._memberPhotoIds={}),r._memberPhotoIds[t.id]=!0,r.trigger("change:photoMembership",t.id,!0),r._lastAddedPhotoHistory=_.reject(r._lastAddedPhotoHistory,function(e){return e.id===t.id}),r._lastAddedPhotoHistory.push(t));return r.set("updated_at",(new Date).toISOString())})},o.prototype.removePhotos=function(e){var t,o,r=this;return o={_method:"put",remove:{photos:function(){var o,r,i;for(i=[],o=0,r=e.length;r>o;o++)t=e[o],i.push(t.id);return i}()}},$.post("https://api.500px.com/v1/users/"+this.get("user_id")+"/galleries/"+this.get("id")+"/items",o).done(function(o){var i,n,s;for(i=0,n=e.length;n>i;i++)t=e[i],"removed"===(null!=(s=o[t.id])?s.result:void 0)&&(null==r._memberPhotoIds&&(r._memberPhotoIds={}),delete r._memberPhotoIds[t.id],r.trigger("change:photoMembership",t.id,!1),r._lastAddedPhotoHistory=_.reject(r._lastAddedPhotoHistory,function(e){return e.id===t.id}));return r.set("updated_at",(new Date).toISOString())})},o.prototype.getLastAddedPhoto=function(){var e;return null==this._lastAddedPhotoHistory&&(this._lastAddedPhotoHistory=[],e=this.get("last_added_photo"),null!=e&&this._lastAddedPhotoHistory.push(new App.Models.Photo(e))),_.last(this._lastAddedPhotoHistory)},o.prototype.getPrivateShareUrl=function(){var e=this;return null==this.privateUrlDfd&&(this.privateUrlDfd=$.Deferred(),$.get("https://api.500px.com/v1/users/"+this.get("user_id")+"/galleries/"+this.get("id")+"/share_url").done(function(t){return e.privateUrlDfd.resolve("https://500px.com/"+t.share_url)}).fail(function(){var t;return(t=e.privateUrlDfd).reject.apply(t,arguments)})),this.privateUrlDfd.promise()},o.prototype.getCanonicalPath=function(){var e,t,o,r;return this.isPrivate()?"/g/"+this.get("token"):(e=null!=(r=this.galleryPath)?r:this.get("custom_path"),null==e&&(e=this.id),t=this.get("user"),o=_.isFunction(t.get)?t.get("username"):t.username,"/"+o+"/galleries/"+e)},o.prototype.getCanonicalUrl=function(){var e;return e=this.getCanonicalPath(),"https://500px.com"+e},o.prototype.getUrl=function(){var e,t;return e=this.get("user"),t=_.isFunction(e.get)?e.get("username"):e.username,"https://500px.com/"+t+"/galleries/"+this.get("custom_path")},o.prototype.isOwnedByCurrentUser=function(){var e;return this.get("user_id")===(null!=(e=App.currentUser)?e.get("id"):void 0)},o.prototype.shouldSubmitSharelizerCounts=function(){return!1},o.prototype.share=function(e,t){return null==this.popup&&(this.popup=new App.Lib.Sharelizer({url:this.getCanonicalUrl(),category:"Gallery Page"})),this[e](t)},o.prototype.google=function(){return this.popup.google()},o.prototype.facebook=function(){return this.popup.facebook()},o.prototype._pinterestShareData=function(){var e;return{media:null!=(e=this.get("cover_photo"))?e[0].url:void 0,description:this.get("description")}},o.prototype.pinterest=function(){var e;if(e=this._pinterestShareData(),!e.media||!e.description)throw"This view doesn't know how to share with pinterest";return this.popup.pinterest(e.media,e.description)},o.prototype._twitterShareData=function(){return{text:'Gallery "'+this.get("name")+'" by '+this.get("user").fullname+" #500px"}},o.prototype.twitter=function(){var e;if(e=this._twitterShareData(),!e.text)throw"This view doesn't know how to share with twitter";return this.popup.twitter(e.text)},o.prototype._stumbleuponShareData=function(){return{title:'Gallery "'+this.get("name")+'" by '+this.get("user").fullname+" #500px"}},o.prototype.stumbleupon=function(){var e;if(e=this._stumbleuponShareData(),!e.title)throw"This view doesn't know how to share with StumbleUpon";return this.popup.stumbleupon(e)},o.prototype.isFeatured=function(){return!!this.get("editors_choice")},o.prototype.feature=function(){var e,t,o=this;if(!App.currentUser)throw new Error("feature requires current user");if(this.isFeatured())throw new Error("gallery is already featured");return t="https://api.500px.com/v1/users/"+this.userId+"/galleries/"+this.galleryPath+"/editors_choice/add",e={method:"PUT"},$.ajax(t,e).done(function(){return o.set({editors_choice:!0})})},o.prototype.unfeature=function(){var e,t,o=this;if(!App.currentUser)throw new Error("feature requires current user");if(!this.isFeatured())throw new Error("gallery is not featured");return t="https://api.500px.com/v1/users/"+this.userId+"/galleries/"+this.galleryPath+"/editors_choice/remove",e={method:"PUT"},$.ajax(t,e).done(function(){return o.set({editors_choice:!1})})},o.prototype.reportContent=function(e,t){var o,r,i=this;return null==t&&(t=""),r="https://api.500px.com/v1/users/"+this.userId+"/galleries/"+this.id+"/report",o={reason:e},0===Number(e)&&(o.reason_details=t),$.post(r,o).done(function(){return i.trigger("contentReported",e)})},o}(Backbone.Model)}.call(this),function(){var e,t,o={}.hasOwnProperty,r=function(e,t){function r(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};e=App.module("Galleries.Collections"),e.RelatedGalleries=function(e){function o(){return t=o.__super__.constructor.apply(this,arguments)}return r(o,e),o.prototype.model=App.Models.Gallery,o.prototype.NUM_GALLERIES=3,o.prototype.initialize=function(e,t){if(null==t&&(t={}),o.__super__.initialize.apply(this,arguments),this.gallery=t.gallery,!this.gallery)throw new Error("RelatedGalleries collection requires a gallery")},o.prototype.parse=function(e){var t,o;return t=function(){var t,r,i,n;for(i=e.galleries,n=[],t=0,r=i.length;r>t;t++)o=i[t],o.id!==this.gallery.id&&o.items_count>0&&n.push(o);return n}.call(this),_.first(t,this.NUM_GALLERIES)},o.prototype.url=function(){var e;return e={privacy:"public",thumb_size:3,rpp:this.NUM_GALLERIES+1,sort:"position",sort_direction:"asc",page:1,include_cover:!0,cover_size:440,kinds:"0,4"},"https://api.500px.com/v1/users/"+this.gallery.get("user_id")+"/galleries?"+$.param(e)},o}(Backbone.Collection)}.call(this),function(){var e,t,o={}.hasOwnProperty,r=function(e,t){function r(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};e=App.module("Galleries.Models"),e.Gallery=function(e){function o(){return t=o.__super__.constructor.apply(this,arguments)}return r(o,e),o.prototype.initialize=function(e){return null==e&&(e={}),this.userId=e.userId,this.galleryPath=e.galleryPath},o.prototype.url=function(){var e,t;return e={include_user:!0,include_cover:1,cover_size:2048},t="https://api.500px.com/v1/users/"+this.userId+"/galleries",null!=this.galleryPath&&(t+="/"+this.galleryPath),""+t+"?"+$.param(e)},o.prototype.parse=function(e){return e.gallery},o}(App.Models.Gallery)}.call(this),function(){var e,t=[].indexOf||function(e){for(var t=0,o=this.length;o>t;t++)if(t in this&&this[t]===e)return t;return-1};e="undefined"!=typeof App&&null!==App?App:window,e.currentPath=function(){return window.location.href.replace(/^https?:\/\/.*?(\/.*)$/,"$1")},e.updatePaginationParam=function(o,r){return o=0|o,null==r&&(r=e.currentPath()),r.match(/\bpage=\d+\b/)?1>=o?(r=r.replace(/\?page=\d+$/,""),r=r.replace(/\?page=\d+&/,"?"),r.replace(/&page=\d+\b/,"")):r.replace(/([?&])page=\d+/,"$1page="+o):1===o?r:""+r+(t.call(r,"?")>=0?"&":"?")+"page="+o}}.call(this),function(){var e,t,o={}.hasOwnProperty,r=function(e,t){function r(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};e=App.module("Galleries"),e.Controller=function(e){function o(){return t=o.__super__.constructor.apply(this,arguments)}return r(o,e),o.prototype.showPublicGallery=function(e,t){var o=this;return App.Photos.executeActionWithPhotoModal(function(){return o.showGallery(t)})},o.prototype.showGallery=function(e){var t=this;return this.gallery=new App.Galleries.Models.Gallery({galleryPath:e,userId:App.CuratorId}),this.showEdit=null!=this.tidyIntParam("edit",null),this.gallery.fetch().done(function(){return t.render(App.Galleries.Views.GalleriesLayout,{model:t.gallery,showEdit:t.showEdit})})},o.prototype.showPhoto=function(e){return App.Photos.showPhotoControllerAction(e)},o.prototype.showPrivateGallery=function(e){var t=this;return App.Photos.executeActionWithPhotoModal(function(){return t.showGallery(e)})},o}(Marionette.AppController)}.call(this),function(){var e,t,o,r,i,n,s={}.hasOwnProperty,a=function(e,t){function o(){this.constructor=e}for(var r in t)s.call(t,r)&&(e[r]=t[r]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e};o=App.module("Behaviors"),e=$(window),o.HasExtraActionsDropdown=function(o){function i(){return r=i.__super__.constructor.apply(this,arguments)}return a(i,o),i.prototype.onRender=function(){var e,t,o,r;this.dropdowns={},o=this.options,r=[];for(t in o)e=o[t],r.push(this._createExtraActionDropdown(t,e));return r},i.prototype._createExtraActionDropdown=function(o,r){var i,n,s,a,l,p,u,h,c,d,g,m,f,y=this;if(d=this.view[o],null==d)throw new Error("Cannot find region "+o);if(n=this.view.$(d.el),n.data("i18n-button-default")&&(s=n.i18n("button-default",{"return":!0})),m=_.extend(_.clone(r),{buttonText:s}),g=new t(m),d.show(g),c={style:{classes:"extra-actions-qtip-dropdown",def:!1,tip:{width:20,height:10}},position:{my:"top center",at:"bottom center",viewport:$(window),effect:!1,adjust:{method:"flipinvert",y:3}},show:{delay:0,event:"click"},hide:{delay:0,event:"click unfocus"},events:{show:function(){return g.$el.addClass("active"),y.trigger("extraActionsDropdown:show",y,o),e.one("scroll",function(){var e,t;return null!=(e=y.dropdowns)?null!=(t=e[o])?t.qtipApi.hide():void 0:void 0}),e.one("resize",function(){var e,t;return null!=(e=y.dropdowns)?null!=(t=e[o])?t.qtipApi.hide():void 0:void 0})},hide:function(){return g.$el.removeClass("active"),y.trigger("extraActionsDropdown:hide",y,o)}}},$.fn.qtip.zindex=100100,u=g.ui.button.qtip(_.defaults({content:g.$(".extra-actions-dropdown-container").hide()},c)),h=u.qtip("api"),p=$.isFunction(r.dropdownViewClass)?r.dropdownViewClass.call(this.view):r.dropdownViewClass,a=null!=(f=r.compactList)?f:!0,l=new p({model:this.view.model,qtipApi:h,compactList:a}),!$.isFunction(l.handleAction))throw new Error("The implementation of handleAction cannot be found in "+r.dropdownViewClass.name);return l.render(),i=g.$(".extra-actions-dropdown-composite"),a?i.addClass("compact"):i.addClass("list"),i.append(l.$el.addClass("clearfix inside")),this.dropdowns[o]={dropdownView:l,qtipApi:h},l},i.prototype.onDestroy=function(){var e,t,o,r,i;o=this.dropdowns;for(e in o)t=o[e],null!=(r=t.qtipApi)&&r.destroy(!0),null!=(i=t.dropdownView)&&i.destroy();return this.dropdowns=null},i}(Marionette.Behavior),o.HasExtraActionsDropdown.DropdownBase=function(e){function t(){return i=t.__super__.constructor.apply(this,arguments)}return a(t,e),t.prototype.events={"click .extra-action":"_internalHandleAction"},t.prototype.initialize=function(e){return this.qtipApi=e.qtipApi,this.compactList=e.compactList,e},t.prototype._internalHandleAction=function(e){var t,o;if(e.preventDefault(),t=$(e.target).closest(".extra-action"),!t.hasClass("disabled")){if(o=null!=t?t.data("action"):void 0,!o)throw new Error("The action name cannot be found");return this.handleAction(t.data("action"),t),this.qtipApi.hide()}},t}(Marionette.LayoutView),t=function(e){function t(){return n=t.__super__.constructor.apply(this,arguments)}return a(t,e),t.prototype.template="extra_actions_widget",t.prototype.className="extra-actions-widget",t.prototype.ui={button:".extra-actions-button"},t.prototype.initialize=function(e){return null==e&&(e={}),this.buttonClass=e.buttonClass,this.buttonText=e.buttonText,null!=this.buttonClass?this.buttonClass:this.buttonClass="more"},t.prototype.onRender=function(){return this.ui.button.addClass(this.buttonClass),this.buttonText?this.ui.button.text(this.buttonText):void 0},t}(Marionette.ItemView)}.call(this),function(){var e,t,o,r,i,n={}.hasOwnProperty,s=function(e,t){function o(){this.constructor=e}for(var r in t)n.call(t,r)&&(e[r]=t[r]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e},a=[].indexOf||function(e){for(var t=0,o=this.length;o>t;t++)if(t in this&&this[t]===e)return t;return-1};o=App.module("Helpers"),e=function(e){function t(){return r=t.__super__.constructor.apply(this,arguments)}return s(t,e),t.prototype.COUNTABLE_MEDIA=["facebook","twitter","pinterest"],t.isCountable=function(e){return a.call(this.prototype.COUNTABLE_MEDIA,e)>=0},t.prototype.initialize=function(e,t){return this.model=e,this.medium=t},t.prototype.queryCount=function(){var e,t,o,r=this;return o=this.model.getCanonicalUrl(),e=this.convertUrl(o,!1),t=this.convertUrl(o,!0),$.when($.ajax(this._mediumCountQueryUrl(e),{dataType:"jsonp"}),$.ajax(this._mediumCountQueryUrl(t),{dataType:"jsonp"})).done(function(e,t){var o;return o=r._countFromResponse(e[0])+r._countFromResponse(t[0]),r._broadcastCount(null!=o?o:0)}).fail(function(){return r._broadcastCount(0)})},t.prototype._mediumCountQueryUrl=function(e){var t;switch(this.medium){case"facebook":return t="SELECT share_count FROM link_stat WHERE url = '"+e.replace(/'/g,"\\'")+"'","https://graph.facebook.com/fql?q="+encodeURIComponent(t);case"twitter":return"https://cdn.api.twitter.com/1/urls/count.json?url="+encodeURIComponent(e);case"pinterest":return"https://api.pinterest.com/v1/urls/count.json?url="+PxApp.GA.escaped_url_with_utm_tags(e,{utm_medium:"pinterest"})}},t.prototype._broadcastCount=function(e){return this.model.trigger("sharelizers:count:change",this.medium,e),this.trigger("count:change",this.medium,e)},t.prototype._countFromResponse=function(e){var t,o,r,i,n;try{switch(this.medium){case"facebook":return null!=(o=null!=(r=_.first(null!=(i=null!=e?e.data:void 0)?i:[]))?r.share_count:void 0)?o:0;case"twitter":case"pinterest":return null!=(n=null!=e?e.count:void 0)?n:0}}catch(s){return t=s,"undefined"!=typeof console&&null!==console&&console.error(t),0}},t.prototype.convertUrl=function(e,t){return null==t&&(t=!1),t?e.replace(/^http:/,"https:"):e.replace(/^https:/,"http:")},t}(Backbone.Model),t=function(t){function o(){return i=o.__super__.constructor.apply(this,arguments)}return s(o,t),o.prototype.querySharelizerCounts=function(t,o){var r,i,n,s,l,p,u,h,c;if(!$.isFunction(t.getCanonicalUrl))throw new Error("Cannot find #getCanonicalUrl on the model");for(r=function(){var t,r,i;for(i=[],t=0,r=o.length;r>t;t++)n=o[t],e.isCountable(n)&&i.push(n);return i}(),i={},l=0,u=r.length;u>l;l++)n=r[l],i[n]=null;for(c=[],p=0,h=r.length;h>p;p++)n=r[p],s=new e(t,n),this.listenToOnce(s,"count:change",function(e,o){return i[e]=o,!t.shouldSubmitSharelizerCounts()||a.call(_.values(i),null)>=0?void 0:t.submitSharelizerCounts(i)}),c.push(s.queryCount());return c},o.prototype.abbreviateNumber=function(e,t){var o,r,i;if(null==t&&(t=1e3),i=["","k","m","b","t"],r=0>e?"-":"",e=Math.abs(e),t>e)return""+e;for(o=0;e>=1e3&&null!=i[o+1];)e/=1e3,o+=1;return e=parseInt(10*e+.5,10)/10,""+r+e+i[o]},o}(Backbone.Model),null==o.SharelizerCountsManager&&(o.SharelizerCountsManager=new t)}.call(this),function(){var e,t,o,r,i,n,s,a={}.hasOwnProperty,l=function(e,t){function o(){this.constructor=e}for(var r in t)a.call(t,r)&&(e[r]=t[r]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e};i=App.module("Galleries.Views"),e=$(window),o=function(e){function t(){return n=t.__super__.constructor.apply(this,arguments)}return l(t,e),t.prototype.template="gallery_sharing_extra_actions_dropdown",t.prototype.className="gallery-sharing-extra-actions-dropdown",t.prototype.modelEvents={"sharelizers:count:change":"_updateSharelizerCount"},t.prototype.handleAction=function(e,t){return"share"===e?this.model.share(t.data("medium"),{view:this}):this[e].call(this,t)},t.prototype.onRender=function(){var e,t;
return e=function(){var e,o,r,i;for(r=this.$(".sharelizers .extra-action.sharelizer"),i=[],e=0,o=r.length;o>e;e++)t=r[e],i.push($(t).data("medium"));return i}.call(this),App.Helpers.SharelizerCountsManager.querySharelizerCounts(this.model,e)},t.prototype._updateSharelizerCount=function(e,t){var o;if(t>0)return o=App.Helpers.SharelizerCountsManager.abbreviateNumber(t),this.$(".extra-action.sharelizer."+e+" .count").text(o)},t}(App.Behaviors.HasExtraActionsDropdown.DropdownBase),t=function(e){function t(){return s=t.__super__.constructor.apply(this,arguments)}return l(t,e),t.prototype.template="gallery_extra_actions_dropdown",t.prototype.className="gallery_extra_actions_dropdown",t.prototype.ui={featureToggle:".feature_toggle"},t.prototype.templateHelpers=function(){return{isFeatured:this.model.isFeatured(),canBeFeatured:!this.model.isPrivate(),isOwnedByCurrentUser:this.model.isOwnedByCurrentUser()}},t.prototype.handleAction=function(e){switch(e){case"feature":return this.toggleFeature();case"report":return this.reportGallery()}},t.prototype.toggleFeature=function(){var e,t,o,r,i,n,s=this;return this.model.isFeatured()?(n=this.model.unfeature,i=this.ui.featureToggle.i18n("remove-message",{"return":!0}),o=!0,r=this.ui.featureToggle.i18n("flash-remove-success",{"return":!0}),e=this.ui.featureToggle.i18n("remove-button-text",{"return":!0})):(n=this.model.feature,i=this.ui.featureToggle.i18n("add-message",{"return":!0}),r=this.ui.featureToggle.i18n("flash-add-success",{"return":!0}),e=this.ui.featureToggle.i18n("add-button-text",{"return":!0}),o=!1),t=new App.Views.ActionConfirmationModal({message:i,title:this.ui.featureToggle.i18n("title",{"return":!0}),destructiveButton:o,buttonText:e,callback:function(){return n.call(s.model).done(function(){return App.Flash.success(r),s.render()}).fail(function(){var e,t;return e=(t=App.Helpers.API).parseError.apply(t,arguments),App.Flash.error(App.Helpers.API.getErrorMessage(e))})}}),t.showModal()},t.prototype.reportGallery=function(){return new App.Photos.Views.ReportContentModal({model:this.model,type:"gallery"}).showModal()},t}(App.Behaviors.HasExtraActionsDropdown.DropdownBase),i.GalleryButtons=function(e){function i(e){var t,r;e.model.isPrivate()||(null==this.behaviors&&(this.behaviors={}),t={compactList:!1,buttonClass:"share",dropdownViewClass:function(){return o}},null==(r=this.behaviors).HasExtraActionsDropdown&&(r.HasExtraActionsDropdown={}),this.behaviors.HasExtraActionsDropdown.socialShare=t),i.__super__.constructor.apply(this,arguments)}return l(i,e),i.prototype.template="gallery_buttons",i.prototype.className="gallery_buttons",i.prototype.regions={socialShare:".gallery_buttons__sharelizers_region",extraActions:".gallery_buttons__extra_actions_region"},i.prototype.ui={editButton:".edit",sharePrivateButton:".share_private",sharePrivateUrl:".share_private_popover__url"},i.prototype.behaviors={HasButtons:{"@ui.editButton":"onClickEdit"},HasExtraActionsDropdown:{extraActions:{compactList:!1,buttonClass:"gallery_buttons_extra_actions",dropdownViewClass:function(){return t}}}},i.prototype.templateHelpers=function(){return{isPrivate:this.model.isPrivate(),isOwnedByCurrentUser:this.model.isOwnedByCurrentUser()}},i.prototype.onRender=function(){var e=this;return this.listenTo(App.vent,"saved:gallery",function(){return e._toggleSharelizerRegion()}),this.ui.sharePrivateButton.length>0?(this._bindSharePrivateMenu(),this.model.getPrivateShareUrl().done(function(t){return e.ui.sharePrivateUrl.val(t)}).fail(function(){var e,t;return e=(t=App.Helpers.API).parseError.apply(t,arguments),App.Flash.error(App.Helpers.API.getErrorMessage(e))})):void 0},i.prototype.onClickEdit=function(){var e;return e=new App.Galleries.Views.EditModal({model:this.model}),e.showModal()},i.prototype.hidePopover=function(){var e;return null!=(e=this.popover)?e.qtip("toggle",!1):void 0},i.prototype._bindSharePrivateMenu=function(){var e;return e=_.extend({},r,{content:this.$(".share_private_popover"),events:{visible:function(){return $(".share_private_popover__url").select()}}}),this.popover=this.ui.sharePrivateButton.qtip(e).click(function(e){return e.preventDefault()})},i.prototype._toggleSharelizerRegion=function(){return this.model.isPrivate()?$(".gallery_buttons__sharelizers_region").remove():void 0},i}(Marionette.LayoutView),r={style:{classes:"share_private_qtip_dropdown",def:!1,tip:{width:20,height:10,mimic:"top center"}},position:{my:"top center",at:"bottom center",viewport:e,effect:!1,adjust:{y:3}},show:{delay:0,event:"click"},hide:{delay:0,event:"click unfocus"},events:{show:function(){var t=this;return e.one("scroll",function(){return t.qtip("hide")}),e.one("resize",function(){return t.qtip("hide")})}}}}.call(this),function(){var e,t,o={}.hasOwnProperty,r=function(e,t){function r(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};e=App.module("Galleries.Views"),e.EditModal=function(e){function o(){return t=o.__super__.constructor.apply(this,arguments)}return r(o,e),o.prototype.template="edit_gallery_modal",o.prototype.ui={privateUrl:".private_url",cancel:".cancel",save:".submit","delete":".delete",title:".title",titleField:"input.title",privacy:".checkbox_input",description:".description",privateWrapper:".private_wrapper"},o.prototype.events={"click @ui.privateUrl":"onClickPrivateUrl","change @ui.privacy":"onPrivacyChange","keyup @ui.title":"onTitleChange"},o.prototype.behaviors={ModalDialog:{closeButton:".close",closeOnEsc:!0},HasButtons:{"@ui.save":"onClickSave","@ui.cancel":"onClickCancel","@ui.delete":{confirm:function(){return confirm(this.ui["delete"].i18n("confirm",{"return":!0}))},fn:"onClickDelete"}}},o.prototype.templateHelpers=function(){return{createMode:this.createMode}},o.prototype.initialize=function(e){var t;return this.createMode=e.createMode,t=$("body").width(),$("body, .fix_width_on_modal").css("width",""+t+"px")},o.prototype.onRender=function(){var e=this;return this.onTitleChange(),this.createMode?this.$el.addClass("galleries_edit_modal--create"):(this.model.isPrivate()&&(this.ui.privacy.prop("checked",!0),this.ui.privateWrapper.addClass("private_wrapper--visible"),this.ui.description.addClass("description--short")),this.model.getPrivateShareUrl().done(function(t){return e.ui.privateUrl.val(t)}).fail(function(){var e,t;return e=(t=App.Helpers.API).parseError.apply(t,arguments),App.Flash.error(App.Helpers.API.getErrorMessage(e))})),_.defer(function(){return e.ui.titleField.focus()})},o.prototype.onPrivacyChange=function(e){return this.ui.privateWrapper.toggleClass("private_wrapper--visible",e.target.checked),this.ui.description.toggleClass("description--short",e.target.checked),this.trigger("resize")},o.prototype.onClickPrivateUrl=function(){return this.ui.privateUrl.select()},o.prototype.onClickSave=function(){var e,t=this;return this.createMode&&(this.model=new App.Galleries.Models.Gallery({userId:App.currentUser.get("id")}),this.model.set("kind",0),this.model.set("user",App.currentUser)),this.model.set("name",this.ui.title.val()),this.model.set("description",this.ui.description.val()),this.model.set("privacy",this.ui.privacy.prop("checked")===!0),e={},this.createMode&&(e.auto_path=!0),this.model.save(e).done(function(){return t.destroyModal(),App.vent.trigger("saved:gallery"),t.createMode?window.location.href=t.model.getUrl():void 0}).fail(function(){var e,t;return e=(t=App.Helpers.API).parseError.apply(t,arguments),App.Flash.error(App.Helpers.API.getErrorMessage(e))})},o.prototype.onClickCancel=function(){return this.destroyModal()},o.prototype.onClickDelete=function(){var e=this;return this.model.destroy().done(function(){return window.location.href=""+userPath(e.model.get("user"))+"/galleries?gallery_deleted=1"}).fail(function(){var e,t;return e=(t=App.Helpers.API).parseError.apply(t,arguments),App.Flash.error(App.Helpers.API.getErrorMessage(e))})},o.prototype.onTitleChange=function(){return this.ui.save.toggleClass("disabled",this.ui.title.val().length<=1)},o.prototype.resize=function(){return this.$el.width(420),this.trigger("resize")},o.prototype.onDestroy=function(){return $("body, .fix_width_on_modal").css("width","")},o}(Marionette.LayoutView)}.call(this),function(){var e,t,o,r={}.hasOwnProperty,i=function(e,t){function o(){this.constructor=e}for(var i in t)r.call(t,i)&&(e[i]=t[i]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e};t=App.module("Views"),e=$(window),t.SiteNav=function(t){function r(){return o=r.__super__.constructor.apply(this,arguments)}return i(r,t),r.prototype.el="#nav_mouseover",r.prototype.ui={mainNav:".main-nav"},r.prototype.initialize=function(){var t=this;if($("#nav_mouseover").length>0)return this.bindUIElements(),App.Helpers.isDesktop()&&(this.$el.addClass("fixed"),this.$el.hover(function(){return clearTimeout(t._hideNavTimeout),t._showNav()},function(){return t._hideNavTimeout=setTimeout(function(){return t._hideNav()},500)})),e.on("scroll",function(){return 0===e.scrollTop()&&t._showNav(),e.one("scroll",function(){return 0!==e.scrollTop()?t._hideNav():void 0})})},r.prototype._showNav=function(){return this.ui.mainNav.removeClass("transparent").addClass("show")},r.prototype._hideNav=function(){return this.ui.mainNav.removeClass("show").addClass("transparent")},r}(Marionette.View)}.call(this),function(){var e,t,o,r={}.hasOwnProperty,i=function(e,t){function o(){this.constructor=e}for(var i in t)r.call(t,i)&&(e[i]=t[i]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e};t=App.module("Galleries.Views"),e=$(window),t.GalleriesHeader=function(t){function r(){return o=r.__super__.constructor.apply(this,arguments)}return i(r,t),r.prototype.template="galleries_header",r.prototype["class"]="galleries_header",r.prototype.ui={galleriesHeader:".galleries_header",coverPhoto:".cover_photo",coverImage:".image",stickyUI:".sticky_ui",galleryDetails:".gallery_details",galleryCurator:".curator",privateIcon:".gallery_details__private_icon"},r.prototype.regions={galleryButtonsRegion:".gallery_buttons_region",stickyGalleryButtonsRegion:".sticky_ui__gallery_buttons_region"},r.prototype.modelEvents={"change:cover_photo":"_updateCoverPhoto _bindScroll"},r.prototype.events={"click #reveal_nsfw_cover":"onRevealNSFWCover"},r.prototype.templateHelpers=function(){var e;return{cover_photo_url:null!=(e=this.model.getCoverPhoto())?e.url:void 0,curator_fullname:this.curator.get("fullname"),curator_avatar_url:this.curator.get("avatars").tiny.https}},r.prototype.initialize=function(e){return this.curator=e.curator,this.siteNavView=new App.Views.SiteNav},r.prototype.onRender=function(){var e,t,o,r;return t=null!=(o=this.model.get("cover_photo"))?null!=(r=o[0])?r.nsfw:void 0:void 0,null==this.model.get("cover_photo")||t||this.ui.galleriesHeader.addClass("galleries_header--with_cover"),null!=this.model.get("cover_photo")&&t&&this.ui.galleriesHeader.addClass("galleries_header--nsfw_cover"),e=this.model.isEmpty()?"gallery-by-html":this.model.containsOwnerPhotosOnly()?"photos-by-html":"curated-by-html",this.ui.galleryCurator.i18n(e,{curator_fullname:this.curator.get("fullname"),href:userPath(this.curator),html:!0}),this.galleryButtonsRegion.show(new App.Galleries.Views.GalleryButtons({model:this.model})),this.stickyGalleryButtonsRegion.show(new App.Galleries.Views.GalleryButtons({model:this.model})),this.model.isPrivate()?this.ui.privateIcon.addClass("gallery_details__private_icon--visible"):void 0},r.prototype.onShow=function(){var e=this;return _.defer(function(){return App.Helpers.isDesktop()?e._bindScroll(!0):void 0}),this.listenTo(App.vent,"resize_header",function(){return e._updateNavOffset()}),_.defer(function(){return e._updateNavOffset()}),$("html").scrollspy({min:function(){return e.navOffset},max:99999999,namespace:"gallery_header",onEnter:function(){return $("#content").addClass("sticky_nav")},onLeave:function(){return $("#content").removeClass("sticky_nav"),e.stickyGalleryButtonsRegion.currentView.hidePopover()}})},r.prototype._updateNavOffset=function(){return this.navOffset=this.ui.galleriesHeader.offset().top+this.ui.galleriesHeader.height()},r.prototype._updateCoverPhoto=function(){var e,t;return e=null!=(t=this.model.getCoverPhoto())?t.url:void 0,this.ui.coverImage.css("background-image","url("+e+")")},r.prototype.onDestroy=function(){return e.off("scroll.gallery_header")},r.prototype.onRevealNSFWCover=function(){return this.ui.galleriesHeader.removeClass("galleries_header--nsfw_cover"),null!=this.model.get("cover_photo")&&this.ui.galleriesHeader.addClass("galleries_header--with_cover"),!1},r.prototype._bindScroll=function(t){var o,r,i=this;return null==t&&(t=!1),t&&(this._originalCoverHeight=this.ui.coverPhoto.outerHeight()),null!=(null!=(r=this.model.get("cover_photo"))?r[0]:void 0)?(o=this.model.get("cover_photo")[0].url,App.Helpers.loadImage(o).done(function(o){var r,n;return r=120,i._coverHeight=(o.height>e.height()?e.height():o.height)-r,i.ui.coverPhoto.css("height",i._coverHeight),0===e.scrollTop()&&t&&e.scrollTop(i._coverHeight-i._originalCoverHeight),App.vent.trigger("resize_header"),n=$(window).height(),t?e.on("scroll.gallery_header",function(){return window.scrollY<i._coverHeight?i.ui.coverImage.css("transform","translate3d(0, "+window.scrollY/2+"px, 0)"):void 0}):void 0})):void 0},r}(Marionette.LayoutView)}.call(this),function(){var e,t,o,r,i={}.hasOwnProperty,n=function(e,t){function o(){this.constructor=e}for(var r in t)i.call(t,r)&&(e[r]=t[r]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e};t=App.module("Photos.Models"),t.UserMembership=function(e){function t(){return o=t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.initialize=function(e,o){var r,i,n;null==o&&(o={}),i={id:e.id};for(r in e)n=e[r],/^membership\_attr\_/.test(r)&&(i[r]=n);for(r in i)n=i[r],"id"!==r&&delete e[r];return this.user=App.Photos.Models.UserManager.createOrUpdateModel(e),t.__super__.initialize.call(this,i,o)},t.prototype.toJSON=function(){return this.user.toJSON()},t.prototype.getUser=function(){return this.user},t}(Backbone.Model),t.User=function(e){function t(){return r=t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.initialize=function(e,o){if(null==o&&(o={}),this.fromCacheManager=o.fromCacheManager,!this.fromCacheManager)throw new Error("User objects should be managed by App.Photos.Models.UserManager");return t.__super__.initialize.apply(this,arguments)},t.prototype.getFollowState=function(){return!!this.get("following")},t.prototype.isSelf=function(){var e;return(null!=(e=App.currentUser)?e.id:void 0)===this.id},t.prototype.follow=function(e){var t=this;return $.post("/"+this.get("username")+"/follow").done(function(){return t.set({followers_count:t.get("followers_count")+1,following:!0}),"function"==typeof e?e(null,!0):void 0}).fail(function(){var o,r;return o=(r=App.Helpers.API).parseError.apply(r,arguments),"function"==typeof e?e(o,t.getFollowState()):void 0})},t.prototype.unfollow=function(e){var t=this;return $.post("/"+this.get("username")+"/unfollow").done(function(){return t.set({followers_count:t.get("followers_count")-1,following:!1}),"function"==typeof e?e(null,!1):void 0}).fail(function(){var o,r;return o=(r=App.Helpers.API).parseError.apply(r,arguments),"function"==typeof e?e(o,t.getFollowState()):void 0})},t}(App.Models.User),e=function(){function e(){}return e.prototype.cache={},e.prototype.createOrUpdateModel=function(e){var t,o;return t=e.id,o=this.cache[t],null==o&&(o=this.cache[t]=new App.Photos.Models.User({},{fromCacheManager:!0})),this._updateModelAttributes(o,e),o},e.prototype._updateModelAttributes=function(e,t){return e.set(t)},e.prototype._shouldFetch=function(e,t){var o;return null==t&&(t={}),o=null==e,t.followingStates&&(o||(o=null==e.get("following"))),o},e.prototype.getModelById=function(e,t){var o;return null==t&&(t={}),o=this.cache[e],t.noFetch?o:void 0},e}(),null==t.UserManager&&(t.UserManager=new e)}.call(this),function(){var e,t,o={}.hasOwnProperty,r=function(e,t){function r(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};e=App.module("Views"),e.GalleryCardView=function(e){function o(){return t=o.__super__.constructor.apply(this,arguments)}return r(o,e),o.prototype.tagName="div",o.prototype.template="gallery_card_view",o.prototype.className="gallery_card_view px_card medium no_badge",o.prototype.ui={galleryPhotoCount:".gallery_card_view__photo_count",privateIcon:".gallery_card_view__private_icon",nameWrapper:".gallery_card_view__name_wrapper"},o.prototype.templateHelpers=function(){var e,t,o,r;return e=this.showNSFWplaceholder?"":null!=(o=this.model.get("cover_photo"))?null!=(r=o[0])?r.url:void 0:void 0,t=this.model.isPrivate()?this.model.getCanonicalPath():""+userPath(this.user)+"/galleries/"+this.model.get("custom_path"),{imageUrl:e,href:t,isPrivate:this.model.isPrivate(),includeAvatar:this.includeAvatar,avatar:this.user.userpic_https_url,avatarUrl:userPath(this.user),userFullName:this.user.fullname,containsOwnerPhotosOnly:this.model.containsOwnerPhotosOnly()}},o.prototype.initialize=function(e){var t,o,r,i,n;if(o=null!=(r=null!=(i=App.currentUser)?i.get("show_nude"):void 0)?r:!1,t=this.model.get("cover_photo").length>0&&this.model.get("cover_photo")[0].nsfw,this.showNSFWplaceholder=!o&&t,this.includeAvatar=e.includeAvatar,this.user=null!=(n=this.options.user)?n:this.model.get("user"),null==this.user)throw new Error("@user is missing")},o.prototype.onRender=function(){var e;return this.includeAvatar||this.$el.addClass("no_avatar"),e=this.model.containsOwnerPhotosOnly()?"photos-by":"curated-by",this.showNSFWplaceholder&&this.$el.addClass("nsfw_placeholder"),this.ui.galleryPhotoCount.i18n(e,{count:this.model.get("items_count")}),this.model.isPrivate()&&this.ui.privateIcon.addClass("gallery_card_view__private_icon--visible"),this.$el.data("id",this.model.id)},o}(Marionette.ItemView)}.call(this),function(){var e,t,o={}.hasOwnProperty,r=function(e,t){function r(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};e=App.module("Views"),e.SignupTeaser=function(e){function o(){return t=o.__super__.constructor.apply(this,arguments)}return r(o,e),o.prototype.template="signup_teaser_view",o.prototype.className="signup_teaser_view",o}(Marionette.ItemView)}.call(this),function(){var e,t,o,r,i,n,s,a,l={}.hasOwnProperty,p=function(e,t){function o(){this.constructor=e}for(var r in t)l.call(t,r)&&(e[r]=t[r]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e};r=App.module("Galleries.Views"),e=$(window),r.GalleriesLayout=function(e){function t(){return i=t.__super__.constructor.apply(this,arguments)}return p(t,e),t.prototype.template="galleries_layout",t.prototype.className="galleries_layout",t.prototype.regions={headerRegion:".header_region",bodyRegion:".body_region"},t.prototype.initialize=function(e){var t,o=this;return null==e&&(e={}),this.curator=App.Photos.Models.UserManager.createOrUpdateModel(this.model.get("user")),this.showEdit=null!=(t=e.showEdit)?t:!1,null!=App.currentUser&&App.currentUser.id===this.curator.get("id")&&this.$el.addClass("owner"),this.listenTo(App.vent,"saved:gallery",function(){return o._showRegions()})},t.prototype.onShow=function(){var e;return this._showRegions(),this.showEdit?(this.showEdit=!1,e=new App.Galleries.Views.EditModal({model:this.model}),e.showModal()):void 0},t.prototype._showRegions=function(){return this.headerRegion.show(new r.GalleriesHeader({model:this.model,curator:this.curator})),this.bodyRegion.show(new r.GalleriesBody({model:this.model,curator:this.curator}))},t}(Marionette.LayoutView),o=function(e){function t(){return n=t.__super__.constructor.apply(this,arguments)}return p(t,e),t.prototype.template="related_galleries_view",t.prototype.className="related_galleries_view",t.prototype.childView=App.Views.GalleryCardView,t.prototype.childViewContainer=".cards_container",t.prototype.templateHelpers=function(){var e;return e=$.trim(this.model.get("user").firstname),e||(e=this.model.get("user").username),{curator:e}},t.prototype.childViewOptions=function(){return{user:this.model.get("user")}},t}(Marionette.CompositeView),r.GalleriesBody=function(r){function i(){return s=i.__super__.constructor.apply(this,arguments)}return p(i,r),i.prototype.template="galleries_body",i.prototype["class"]="galleries_body",i.prototype.regions={photoGridRegion:".photo_grid_region",moreGalleriesRegion:".galleries_body__more_galleries_region",mobileCTARegion:".galleries_body__mobile_cta_region",signupTeaserRegion:".galleries_body__signup_teaser_region"},i.prototype.ui={reorderCallout:".reorder_callout",reorderCalloutDismiss:".reorder_callout a",loadMorePhotosContainer:".galleries_body__load_more_container",loadMorePhotos:".galleries_body__load_more",mobileCTA:".galleries_body__mobile_cta_region",photoGrid:".photo_grid_region"},i.prototype.behaviors={HasButtons:{"@ui.reorderCalloutDismiss":"dismissReorderCallout","@ui.loadMorePhotos":"onClickLoadMore"}},i.prototype.templateHelpers=function(){return{withMultiplePhotos:this.model.get("items_count")>=2}},i.prototype.initialize=function(e){var t=this;return this.curator=e.curator,this.listenTo(App.vent,"showPhoto",function(e,o){var r,i;return i=o.navigationContext,r=App.Photos.show(e.id,{navigationContext:i}),t.listenToOnce(r,"before:destroyModal",function(){var e;return e=i.selectedPhotoOffset(),t.trigger("scroll",e)})}),this.on("scroll",this.scrollToShow)},i.prototype.onShow=function(){var e,o,r,i,n=this;return e=this.model.get("privacy")===!0?this.model.get("galleryPath"):this.model.get("id"),this.galleryPhotos=new App.Galleries.Collections.GalleryPhotos(!1,{galleryPath:e,userId:this.curator.get("id")}),this.ui.loadMorePhotosContainer.hide(),this.galleryPhotos.fetch().done(function(){return n.$(".photo_grid_region").addClass("photo_grid_region--fetched"),n.galleryPhotos.finished()?void 0:n.ui.loadMorePhotosContainer.show()}),i=this.model.containsOwnerPhotosOnly(),o=this._viewedOnPhoneOrTablet(),r={collection:this.galleryPhotos,showTitle:i,hasHoverState:!0,emptyView:t,emptyViewOptions:{isOwnedByCurrentUser:this.model.isOwnedByCurrentUser(),curator:this.model.get("user")},waitThumbnailsLoad:!1,hasVisibleCredits:!i,isSortable:this.model.isOwnedByCurrentUser()&&!o,gallery:this.model,hideLastRow:o},this.photoGrid=new App.Photos.Views.FullAspectRatioPhotoGrid(r),this.photoGridRegion.show(this.photoGrid),this.listenTo(this.galleryPhotos,"pagination:end",function(){return _.defer(function(){return n.photoGrid.showLastRow(),o||0===n.galleryPhotos.length&&n.model.isOwnedByCurrentUser()?void 0:n._showMoreGalleriesAndSignupTeaser()})}),this.listenTo(this.photoGrid,"change:photoOrder",this.reorderPhoto),o?(this.photoGrid.pauseInfiniteScroll(),this.mobileCTARegion.show(new App.Helpers.MobileCTA({heading:this.ui.mobileCTA.i18n("heading",{"return":!0}),subheading:this.ui.mobileCTA.i18n("subheading",{"return":!0}),button:this.ui.mobileCTA.i18n("button",{"return":!0}),content:{androidPhone:"<img src='/assets/mobile_cta/stars.png' /><div>"+this.ui.mobileCTA.i18n("android-ratings",{"return":!0})+"</div>",androidTablet:"<img src='/assets/mobile_cta/stars.png' /><div>"+this.ui.mobileCTA.i18n("android-ratings",{"return":!0})+"</div>","default":"<img src='/assets/mobile_cta/stars.png' /><div>"+this.ui.mobileCTA.i18n("ratings",{"return":!0})+"</div>"}}))):void 0},i.prototype.reorderPhoto=function(e,t){return this.galleryPhotos.reorder(e,t).fail(function(){var e,t;return e=(t=App.Helpers.API).parseError.apply(t,arguments),App.Flash.error(App.Helpers.API.getErrorMessage(e))})},i.prototype.onClickLoadMore=function(){return this.photoGrid.continueInfiniteScroll(),this.mobileCTARegion.reset(),this.ui.loadMorePhotosContainer.hide()},i.prototype._showMoreGalleriesAndSignupTeaser=function(){var e=this;return this.relatedGalleries=new App.Galleries.Collections.RelatedGalleries(!1,{gallery:this.model}),this.relatedGalleries.fetch().done(function(){return e.relatedGalleries.length>0&&e.moreGalleriesRegion.show(new o({collection:e.relatedGalleries,model:e.model})),e._viewedOnPhoneOrTablet()||null!=App.currentUser?void 0:e.signupTeaserRegion.show(new App.Views.SignupTeaser)})},i.prototype._viewedOnPhoneOrTablet=function(){return null==this.$body&&(this.$body=$("body")),this.$body.hasClass("smartphone")||this.$body.hasClass("tablet")},i.prototype.scrollToShow=function(t){return null==this.pxTabsHeight&&(this.pxTabsHeight=$(".px_tabs").height()),e.scrollTop(this.$(".full-aspect-ratio-photo-grid .photo_thumbnail").eq(t).offset().top-this.pxTabsHeight)},i.prototype.dismissReorderCallout=function(){return null!=App.currentUser?$.cookie("dismiss_tooltip_reorder_gallery_photos_"+App.currentUser.id,1,{expires:365,path:"/"},this.ui.reorderCallout.hide()):void 0},i}(Marionette.LayoutView),t=function(e){function t(){return a=t.__super__.constructor.apply(this,arguments)}return p(t,e),t.prototype.template="empty_gallery_view",t.prototype.className="empty_gallery_view",t.prototype.templateHelpers=function(){return{isOwnedByCurrentUser:this.isOwnedByCurrentUser,curatorDisplayName:this.curatorDisplayName,curatorUserName:this.curatorUserName}},t.prototype.initialize=function(e){return this.curatorDisplayName=$.trim(e.curator.firstname||e.curator.username),this.curatorUserName=e.curator.username,this.isOwnedByCurrentUser=e.isOwnedByCurrentUser},t}(Marionette.ItemView)}.call(this),function(){var e,t,o,r={}.hasOwnProperty,i=function(e,t){function o(){this.constructor=e}for(var i in t)r.call(t,i)&&(e[i]=t[i]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e};t=App.module("Galleries.Views"),e=$(window),t.GalleryPhotoRequestRemovalModal=function(t){function r(){return o=r.__super__.constructor.apply(this,arguments)}return i(r,t),r.prototype.template="gallery_photo_request_removal_modal",r.prototype.className="gallery_photo_request_removal_modal action_modal report-content-modal",r.prototype.ui={closeButton:".header .close",reasonDetails:".content textarea",submitButton:".content .submit"},r.prototype.behaviors={ModalDialog:{closeButton:!1,wrapperClass:"report-content-modal-wrapper",dialogClass:"report-content-modal-dialog"},HasButtons:{"@ui.closeButton":"onCloseClicked","@ui.submitButton":"onSubmitClicked"}},r.prototype.initialize=function(e){if(null==e&&(e={}),this.photo=e.photo,null==this.photo)throw new Error("Gallery photo is missing!")},r.prototype.onShow=function(){return this.ui.reasonDetails.focus()},r.prototype.resize=function(){return e.width()<=360?this.$el.width(e.width()-20):this.$el.width(360),this.trigger("resize")},r.prototype.onCloseClicked=function(){return this.destroyModal()},r.prototype.onSubmitClicked=function(){var e,t=this;return e="[RR:"+this.photo.id+"]"+this.ui.reasonDetails.val(),this.model.reportContent(0,e).done(function(){return App.Flash.success(t.ui.submitButton.i18n("success",{"return":!0})),t.destroyModal()})},r}(Marionette.LayoutView)}.call(this),function(){App.start()}.call(this);